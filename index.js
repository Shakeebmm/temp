!function(t){var e={};function n(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(o,a,function(e){return t[e]}.bind(null,a));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=13)}([function(t,e){t.exports=require("express")},function(t,e){t.exports=require("mongoose")},function(t,e){t.exports=require("moment-timezone")},function(t,e){t.exports=require("promise")},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({name:{type:String},desc:{type:String},location:{type:String},regno:{type:String},address:{type:String},phone:{type:String},nameMal:{type:String},descMal:{type:String},locationMal:{type:String},addressMal:{type:String},receiptNo:{type:Number},medExpiryDays:{type:Number},medThresholdCount:{type:Number},validTill:{type:String},todayAPI:{type:String}},{collection:"centerDetails"});t.exports=o.model("centerDetails",a)},function(t,e,n){const o=n(23),a=function(){const t=new o("SJuPDE*dT12j$*n");let e=null;return{getCrytoHelperInstance:()=>(null==e&&(e={encryptField:e=>t.encrypt(e.toString()),decryptField:e=>t.decrypt(e)}),e)}}();t.exports=a},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({bno:{type:String},name:{type:String},cash:{type:Boolean,default:"0"}},{collection:"bank"});t.exports=o.model("bank",a)},function(t,e,n){const{createLogger:o,format:a,transports:s}=n(18);n(19);const r=n(20),i=n(21),c=function(){r.existsSync(i.LOG_DIRECTORY)||r.mkdirSync(i.LOG_DIRECTORY);let t=null;const e=new s.DailyRotateFile({filename:i.LOG_FILE_NAME,dirname:i.LOG_DIRECTORY,datePattern:i.LOG_FILE_NAME_DATE_PATTERN,json:!0,format:a.combine(a.label({label:i.LOG_LABEL}),a.timestamp(),a.prettyPrint())}),n=o({format:a.combine(a.label(i.LOG_LABEL),a.timestamp({format:i.LOG_IN_CONSOLE_TIMESTAMP_PATTERN}),a.printf(t=>`${t.timestamp} ${t.level} ${t.message}`)),transports:[new s.Console,e],exceptionHandlers:[new s.File({filename:i.LOG_FATAL_FAILURE_FILE_NAME,dirname:i.LOG_DIRECTORY})],exitOnError:!1});return{getLoggerInstance:()=>(null==t&&(t={log:(t,e)=>{setTimeout(()=>{n.log(t,e)},100)}}),t)}}();t.exports=c},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({pno:{type:String},name:{type:String},age:{type:String},address:{type:String},grade:{type:String},gender:{type:String},panjayath:{type:String},wardno:{type:String},phone1:{type:String},phone2:{type:String},regdate:{type:Date},expdate:{type:Date},dropdate:{type:Date},volunteer:{type:String},diagnosis:{type:String},temp:{type:Boolean},route:{type:String},homeCarePlan:{type:String}},{collection:"patient"});t.exports=o.model("Patient",a)},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({txndate:{type:Date},desc:{type:String},type:{type:String},amount:{type:Number},txntype:{type:String},name:{type:String},receiptNo:{type:String},isReceipt:{type:Boolean},paymentMode:{type:String},bankMode:{type:String},bankName:{type:String},txnNo:{type:String},chNo:{type:String},chdate:{type:Date},chBank:{type:String},chAmount:{type:Number}},{collection:"account"});t.exports=o.model("account",a)},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({mno:{type:String},name:{type:String},name_lower:{type:String},stock:{main:{type:Number},sub:{type:Number},a_kit:{type:Number},b_kit:{type:Number}},purchase:[{invdate:{type:Date},invno:{type:String},batchno:{type:String},expdate:{type:Date},mfgdate:{type:Date},rate:{type:Number},dealer:{type:String},mainStock:{type:Number},subStock:{type:Number},return:{type:Number}}]},{collection:"medicine"});t.exports=o.model("medicine",a)},function(t,e,n){const o=n(1),a=o.Schema;let s=new a({bankName:{type:String},bno:{type:String},open:{type:Number},close:{type:Number}}),r=new a({month:{type:Date},balance:{type:[s]}},{collection:"cashBalance"});t.exports=o.model("cashBalance",r)},function(t,e){t.exports=require("dotenv")},function(t,e,n){t.exports=n(14)},function(t,e,n){const o=n(0)(),a=n(15),s=n(16);var r=n(17);n(54);const i=n(7).getLoggerInstance();n(12).config(),o.use(s()),o.use(a.urlencoded({extended:!0})),o.use(a.json()),o.use(r),o.use((function(t,e,n,o){i.log("error",`${t}`),n.status(500).send(JSON.stringify({status:500,message:"Something went wrong.",detail:t.message}))})),o.listen(process.env.PORT,(function(){console.log("Server is running on Port:",process.env.PORT)})),t.exports=o},function(t,e){t.exports=require("body-parser")},function(t,e){t.exports=require("cors")},function(t,e,n){var o=n(0).Router();const a=n(7).getLoggerInstance();var s=n(22),r=n(25),i=n(27),c=n(29),d=n(31),u=n(33),p=n(35),m=n(37),l=n(39),f=n(41),y=n(42),b=n(44),g=n(45),h=n(46),D=n(47),k=n(48),Y=n(51),w=n(53);o.use((t,e,n)=>{a.log("info","Called : "+t.path),n()}),o.use(s),o.use(r),o.use(i),o.use(d),o.use(u),o.use(c),o.use(p),o.use(m),o.use(l),o.use(f),o.use(y),o.use(b),o.use(g),o.use(h),o.use(D),o.use(k),o.use(Y),o.use(w),t.exports=o},function(t,e){t.exports=require("winston")},function(t,e){t.exports=require("winston-daily-rotate-file")},function(t,e){t.exports=require("fs")},function(t,e){t.exports={LOG_LABEL:"PnP Service",LOG_DIRECTORY:"logs",LOG_FILE_NAME:"logs-%DATE%.log",LOG_FILE_NAME_DATE_PATTERN:"YYYY_MM_DD",LOG_IN_CONSOLE_TIMESTAMP_PATTERN:"YYYY-MM-DD HH:mm:ss",LOG_FATAL_FAILURE_FILE_NAME:"fatal_failures.log"}},function(t,e,n){const o=n(0).Router();let a=n(4);const s=n(5).getCrytoHelperInstance(),r=n(2);o.get("*/center/getName",(function(t,e,n){try{a.findOne((function(t,n){e.json(n.name)}))}catch(t){n(new Error(t))}})),o.get("*/center/edit",(function(t,e,n){try{a.findOne((function(t,n){n.validTill=s.decryptField(n.validTill),n.todayAPI=r(new Date(s.decryptField(n.todayAPI))).format("YYYY-MM-DD"),e.json(n)}))}catch(t){n(new Error(t))}})),o.post("*/center/update/:id",(function(t,e,n){try{a.findById(t.params.id,(function(n,o){o?(o.name=t.body.name,o.desc=t.body.desc,o.location=t.body.location,o.regno=t.body.regno,o.address=t.body.address,o.phone=t.body.phone,o.nameMal=t.body.nameMal,o.descMal=t.body.descMal,o.locationMal=t.body.locationMal,o.addressMal=t.body.addressMal,o.medExpiryDays=t.body.medExpiryDays,o.medThresholdCount=t.body.medThresholdCount,o.save().then(t=>{e.json("Update complete")})):e.status(404).send("data is not found")}))}catch(t){n(new Error(t))}})),o.get("*/center/updateTime",(function(t,e,o){try{n(24)("http://worldtimeapi.org/api/timezone/Asia/Kolkata",(function(t,n,o){if(!t&&200==n.statusCode){var i=JSON.parse(o),c=new Date(r(i.utc_datetime).format("YYYY-MM-DD"));a.findOne((function(t,n){n.todayAPI=s.encryptField(c),n.save(),e.json(c)}))}}))}catch(t){o(new Error(t))}})),t.exports=o},function(t,e){t.exports=require("cryptr")},function(t,e){t.exports=require("request")},function(t,e,n){const o=n(0).Router();let a=n(26);const s=n(5).getCrytoHelperInstance();n(2);let r=n(4);o.post("*/login/validate",(function(t,e,n){try{console.log(s.encryptField("2030-03-10")),r.findOne((function(n,o){new Date(s.decryptField(o.todayAPI))<=new Date(s.decryptField(o.validTill))?a.findOne({username:t.body.username},(function(n,o){o&&t.body.password===s.decryptField(o.pwd)?e.status(200).send("Success"):e.status(204).send("Data not found")})):e.status(205).send("Account Expired")}))}catch(t){n(new Error(t))}})),t.exports=o},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({username:{type:String},pwd:{type:String}},{collection:"login"});t.exports=o.model("login",a)},function(t,e,n){const o=n(0);n(3);const a=o.Router(),s=n(2);let r=n(8),i=n(28);function c(t,e,n){n.pno=t.body.pno,n.name=t.body.name,n.age=t.body.age,n.address=t.body.address,n.grade=t.body.grade,n.gender=t.body.gender,n.panjayath=t.body.panjayath,n.route=t.body.route,n.wardno=t.body.wardno,n.phone1=t.body.phone1,n.phone2=t.body.phone2,n.volunteer=t.body.volunteer,n.diagnosis=t.body.diagnosis,n.temp=t.body.temp,n.homeCarePlan=t.body.homeCarePlan,null!=t.body.regdate&&""!=t.body.regdate&&"1970-01-01T00:00:00.000Z"!=t.body.regdate&&(n.regdate=s(t.body.regdate).tz("Asia/Calcutta").format("YYYY-MM-DD")),null!=t.body.expdate&&""!=t.body.expdate&&"1970-01-01T00:00:00.000Z"!=t.body.expdate&&(n.expdate=s(t.body.expdate).tz("Asia/Calcutta").format("YYYY-MM-DD")),null!=t.body.dropdate&&""!=t.body.dropdate&&"1970-01-01T00:00:00.000Z"!=t.body.dropdate?n.dropdate=s(t.body.dropdate).tz("Asia/Calcutta").format("YYYY-MM-DD"):n.dropdate=null,n.save().then(e.status(200).json("Update complete"))}a.post("*/patient/add",(function(t,e,n){try{r.findOne({pno:t.body.pno},(function(n,o){if(o)e.status(204).send("Duplicate");else{let n=new r(t.body);null!=n.regdate&&""!=n.regdate&&(n.regdate=s(n.regdate).tz("Asia/Calcutta").format("YYYY-MM-DD")),null!=n.expdate&&""!=n.expdate&&(n.expdate=s(n.expdate).tz("Asia/Calcutta").format("YYYY-MM-DD")),null!=n.dropdate&&""!=n.dropdate&&(n.dropdate=s(n.dropdate).format("YYYY-MM-DD")),n.save().then(e.status(200).send("Success"))}}))}catch(t){n(new Error(t))}})),a.get("*/patient",(function(t,e,n){try{r.find({$or:[{temp:!1},{temp:void 0}],expdate:null,dropdate:null},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.post("*/patientFilter",(function(t,e,n){try{var o;switch(t.body.status){case"Active":o={expdate:{$eq:null},dropdate:{$eq:null},$or:[{temp:!1},{temp:void 0}]};break;case"Expired":o={expdate:{$ne:null}};break;case"Temp":o={temp:!0};break;case"Dropout":o={dropdate:{$ne:null}}}r.find(o,(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/patient/getNames",(function(t,e,n){try{r.find({$or:[{temp:!1},{temp:void 0}],expdate:null,dropdate:null},{_id:0,name:1,pno:1,homeCarePlan:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/patient/getAllNames",(function(t,e,n){try{r.find({expdate:null,dropdate:null},{_id:0,name:1,pno:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/patient/edit/:id",(function(t,e){let n=t.params.id;r.findById(n,(function(t,n){e.status(200).json(n)}))})),a.post("*/patient/update/:id",(function(t,e,n){try{r.findById(t.params.id,(function(n,o){o?r.findOne({pno:t.body.pno},(function(n,a){a?a._id==t.params.id?c(t,e,o):e.status(204).send("Duplicate"):c(t,e,o)})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),a.get("*/patient/delete/:id",(function(t,e){r.findOneAndDelete({_id:t.params.id},(function(t,n){t?e.json(t):e.json("Successfully removed")}))})),a.post("*/patient/detailsReport",(function(t,e,n){var o=new Date(s(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),a=new Date(s(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));try{if("Date"===t.body.type)r.aggregate([{$match:{regdate:{$gte:o,$lte:a},expdate:{$eq:null},dropdate:{$eq:null},$or:[{temp:!1},{temp:void 0}]}},{$sort:{name:1}}],(function(t,o){t?n(new Error(t)):e.status(200).json(o)}));else if("Grade"===t.body.type)r.aggregate([{$match:{grade:{$eq:t.body.gradeFilter},expdate:{$eq:null},dropdate:{$eq:null},$or:[{temp:!1},{temp:void 0}]}},{$sort:{name:1}}],(function(t,o){t?n(new Error(t)):e.status(200).json(o)}));else if("Status"===t.body.type){var i;switch(t.body.patStatus){case"All":i={pno:{$ne:null}};break;case"Active":i={expdate:{$eq:null},dropdate:{$eq:null},$or:[{temp:!1},{temp:void 0}]};break;case"Expired":i={expdate:{$ne:null}};break;case"Temp":i={temp:!0};break;case"Dropout":i={dropdate:{$ne:null}}}r.aggregate([{$match:i},{$sort:{name:1}}],(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}}catch(t){n(new Error(t))}})),a.post("*/patient/homeCarePlan",(function(t,e,n){try{let n=s(t.body.month).format("YYYY-MM-DD"),o=null!==t.body.date1&&""!==t.body.date1?s(t.body.date1).format("YYYY-MM-DD"):null,a=null!==t.body.date2&&""!==t.body.date2?s(t.body.date2).format("YYYY-MM-DD"):null,r=null!==t.body.date3&&""!==t.body.date3?s(t.body.date3).format("YYYY-MM-DD"):null,c=null!==t.body.date4&&""!==t.body.date4?s(t.body.date4).format("YYYY-MM-DD"):null;i.findOne({pno:t.body.pno,month:n},(function(s,d){if(null!=d)d.date1=o,d.date2=a,d.date3=r,d.date4=c,d.save().then(t=>{e.status(200).json("Update complete")});else{let s=new i(t.body);s.month=n,s.date1=o,s.date2=a,s.date3=r,s.date4=c,s.save().then(t=>{e.status(200).json("Update complete")})}}))}catch(t){n(new Error(t))}})),a.post("*/patient/homeCarePlanLoad",(function(t,e,n){try{let o=s(t.body.month).format("YYYY-MM-DD");i.findOne({pno:t.body.pno,month:o},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),t.exports=a},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({pno:{type:String},month:{type:Date},date1:{type:Date},date2:{type:Date},date3:{type:Date},date4:{type:Date}},{collection:"homeCarePlan"});t.exports=o.model("homeCarePlan",a)},function(t,e,n){const o=n(0);n(3);const a=o.Router();let s=n(30);a.post("*/route/add",(function(t,e,n){console.log("111");try{new s(t.body).save().then(e.status(200).send("Success"))}catch(t){n(new Error(t))}})),a.get("*/route",(function(t,e,n){try{s.find((function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/route/getNames",(function(t,e,n){try{s.find({},{_id:0,name:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/route/edit/:id",(function(t,e){let n=t.params.id;s.findById(n,(function(t,n){e.status(200).json(n)}))})),a.post("*/route/update/:id",(function(t,e,n){try{s.findById(t.params.id,(function(n,o){o?(o.name=t.body.name,o.save().then(t=>{e.status(200).json("Update complete")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),a.get("*/route/delete/:id",(function(t,e){s.findOneAndDelete({_id:t.params.id},(function(t,n){t?e.json(t):e.json("Successfully removed")}))})),t.exports=a},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({name:{type:String}},{collection:"route"});t.exports=o.model("route",a)},function(t,e,n){const o=n(0);var a=n(3);const s=o.Router();let r=n(32);s.post("*/volunteer/add",(function(t,e,n){try{let n=new r(t.body);new a((function(t,e){r.countDocuments((function(e,n){var o=++n;t("V"+o)}))})).then((function(t){n.vno=t,n.save()})),e.status(200).send("Success")}catch(t){n(new Error(t))}})),s.get("*/volunteer",(function(t,e,n){try{r.find((function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),s.get("*/volunteer/getNames",(function(t,e,n){try{r.find({},{_id:0,name:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),s.get("*/volunteer/edit/:id",(function(t,e){let n=t.params.id;r.findById(n,(function(t,n){e.json(n)}))})),s.post("*/volunteer/update/:id",(function(t,e,n){try{r.findById(t.params.id,(function(n,o){o?(o.name=t.body.name,o.location=t.body.location,o.phone=t.body.phone,o.save().then(t=>{e.status(200).json("Update complete")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),s.get("*/volunteer/delete/:id",(function(t,e){r.findOneAndDelete({_id:t.params.id},(function(t,n){t?e.json(t):e.json("Successfully removed")}))})),t.exports=s},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({vno:{type:String},name:{type:String},location:{type:String},phone:{type:String}},{collection:"volunteer"});t.exports=o.model("Volunteer",a)},function(t,e,n){const o=n(0);n(3);const a=o.Router();let s=n(34);a.post("*/panjayath/add",(function(t,e,n){try{new s(t.body).save().then(e.status(200).send("Success"))}catch(t){n(new Error(t))}})),a.get("*/panjayath",(function(t,e,n){try{s.find((function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/panjayath/getNames",(function(t,e,n){try{s.find({},{_id:0,name:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/panjayath/edit/:id",(function(t,e){let n=t.params.id;s.findById(n,(function(t,n){e.status(200).json(n)}))})),a.post("*/panjayath/update/:id",(function(t,e,n){try{s.findById(t.params.id,(function(n,o){o?(o.name=t.body.name,o.save().then(t=>{e.status(200).json("Update complete")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),a.get("*/panjayath/delete/:id",(function(t,e){s.findOneAndDelete({_id:t.params.id},(function(t,n){t?e.json(t):e.json("Successfully removed")}))})),t.exports=a},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({name:{type:String}},{collection:"panjayath"});t.exports=o.model("panjayath",a)},function(t,e,n){const o=n(0);n(3);const a=o.Router();let s=n(36);a.post("*/diagnosis/add",(function(t,e,n){try{new s(t.body).save().then(e.status(200).send("Success"))}catch(t){n(new Error(t))}})),a.get("*/diagnosis",(function(t,e,n){try{s.find((function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/diagnosis/getNames",(function(t,e,n){try{s.find({},{_id:0,name:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/diagnosis/edit/:id",(function(t,e){let n=t.params.id;s.findById(n,(function(t,n){e.status(200).json(n)}))})),a.post("*/diagnosis/update/:id",(function(t,e,n){try{s.findById(t.params.id,(function(n,o){o?(o.name=t.body.name,o.save().then(t=>{e.status(200).json("Update complete")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),a.get("*/diagnosis/delete/:id",(function(t,e){s.findOneAndDelete({_id:t.params.id},(function(t,n){t?e.json(t):e.json("Successfully removed")}))})),t.exports=a},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({name:{type:String}},{collection:"diagnosis"});t.exports=o.model("diagnosis",a)},function(t,e,n){const o=n(0);n(3);const a=o.Router();let s=n(38);a.post("*/incomeType/add",(function(t,e,n){try{new s(t.body).save().then(e.status(200).send("Success"))}catch(t){n(new Error(t))}})),a.get("*/incomeType",(function(t,e,n){s.find((function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),a.get("*/incomeType/getIncomeTypes",(function(t,e,n){try{s.find({},{_id:0,incomeType:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/incomeType/edit/:id",(function(t,e){let n=t.params.id;s.findById(n,(function(t,n){e.status(200).json(n)}))})),a.post("*/incomeType/update/:id",(function(t,e,n){try{s.findById(t.params.id,(function(n,o){o?(o.incomeType=t.body.incomeType,o.save().then(t=>{e.status(200).json("Update complete")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),a.get("*/incomeType/delete/:id",(function(t,e){s.findOneAndDelete({_id:t.params.id},(function(t,n){t?e.json(t):e.json("Successfully removed")}))})),t.exports=a},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({incomeType:{type:String}},{collection:"incomeType"});t.exports=o.model("incomeType",a)},function(t,e,n){const o=n(0);n(3);const a=o.Router();let s=n(40);a.post("*/expType/add",(function(t,e,n){try{new s(t.body).save().then(e.status(200).send("Success"))}catch(t){n(new Error(t))}})),a.get("*/expType",(function(t,e,n){s.find((function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),a.get("*/expType/getExpenseTypes",(function(t,e,n){try{s.find({},{_id:0,expType:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.get("*/expType/edit/:id",(function(t,e){let n=t.params.id;s.findById(n,(function(t,n){e.status(200).json(n)}))})),a.post("*/expType/update/:id",(function(t,e,n){try{s.findById(t.params.id,(function(n,o){o?(o.expType=t.body.expType,o.save().then(t=>{e.status(200).json("Update complete")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),a.get("*/expType/delete/:id",(function(t,e){s.findOneAndDelete({_id:t.params.id},(function(t,n){t?e.json(t):e.json("Successfully removed")}))})),t.exports=a},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({expType:{type:String}},{collection:"expType"});t.exports=o.model("expType",a)},function(t,e,n){const o=n(2),a=n(0).Router();let s=n(9),r=n(4),i=n(6);a.post("*/account/add",(function(t,e,n){try{let n=new s(t.body);n.txndate=o(n.txndate).format("YYYY-MM-DD"),n.chdate=null!==n.chdate?o(n.chdate).format("YYYY-MM-DD"):null,"Cheque"===n.bankMode&&(n.chAmount=n.amount,n.amount=0),n.isReceipt?r.findOne((function(t,e){n.receiptNo=e.receiptNo,e.receiptNo++,e.save(),n.save()})):n.save(),e.status(200).send(n._id)}catch(t){n(new Error(t))}})),a.post("*/account/addCE",(function(t,e,n){try{let n=new s(t.body);n.txndate=o(n.txndate).format("YYYY-MM-DD"),n.type="Contra Entry",n.name="",n.isReceipt=!1,"Cash"===t.body.source?(n.txntype="Expense",n.desc="Contra Entry - Cash",n.amount=-1*t.body.amount,n.paymentMode="Cash",n.bankMode="",n.bankName=""):(n.desc="Contra Entry - Bank",n.txntype="Expense",n.amount=-1*t.body.amount,n.paymentMode="Bank",n.bankMode="Transfer",n.bankName=t.body.bankName),n.save().then(a=>{n=new s(t.body),n.txndate=o(n.txndate).format("YYYY-MM-DD"),n.desc="Contra Entry",n.type="Contra Entry",n.name="",n.isReceipt=!1,"Cash"===t.body.source?(n.desc="Contra Entry - Bank",n.txntype="Income",n.amount=t.body.amount,n.paymentMode="Bank",n.bankMode="Transfer",n.bankName=t.body.bankName):(n.desc="Contra Entry - Cash",n.txntype="Income",n.amount=t.body.amount,n.paymentMode="Cash",n.bankMode="",n.bankName=""),n.save().then(t=>{e.status(200).send("Success")})})}catch(t){n(new Error(t))}})),a.post("*/account",(function(t,e,n){var a=new Date(o(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),r=new Date(o(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));s.find({$or:[{txntype:"Income"},{txntype:"Expense"}],txndate:{$gte:a,$lte:r},amount:{$ne:0}},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),a.get("*/account/getCheques",(function(t,e,n){s.find({bankMode:"Cheque",amount:0},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),a.post("*/account/receipts",(function(t,e,n){var a=new Date(o(t.body.fromDate).format("YYYY-MM-DD")),r=new Date(o(t.body.toDate).format("YYYY-MM-DD"));s.find({$or:[{txntype:"Income"},{txntype:"Expense"}],txndate:{$gte:a,$lte:r},isReceipt:!0},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),a.get("*/account/edit/:id",(function(t,e){let n=t.params.id;s.findById(n,(function(t,n){e.status(200).json(n)}))})),a.post("*/account/update/:id",(function(t,e,n){try{s.findById(t.params.id,(function(n,a){a?(a.desc=t.body.desc,a.type=t.body.type,a.amount=t.body.amount,a.name=t.body.name,a.isReceipt=t.body.isReceipt,a.paymentMode=t.body.paymentMode,a.bankMode=t.body.bankMode,a.bankName=t.body.bankName,a.txnNo=t.body.txnNo,a.chNo=t.body.chNo,a.chBank=t.body.chBank,a.chdate=null!==t.body.chdate&&""!==t.body.chdate?o(t.body.chdate).format("YYYY-MM-DD"):null,a.save().then(t=>{e.status(200).json("Update complete")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),a.get("*/account/delete/:id",(function(t,e){s.findOneAndDelete({_id:t.params.id},(function(t,n){t?e.json(t):e.json("Successfully removed")}))})),a.post("*/account/summaryReport",(function(t,e,n){var a=new Date(o(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),r=new Date(o(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));try{"Date"===t.body.type?s.aggregate([{$match:{txndate:{$gte:a,$lte:r}}},{$group:{_id:{txntype:"$txntype",txndate:"$txndate"},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.txndate":1}}],(function(t,o){t?n(new Error(t)):e.json(o)})):"Month"===t.body.type?s.aggregate([{$match:{txndate:{$gte:a,$lte:r}}},{$group:{_id:{txntype:"$txntype",month:{$month:"$txndate"},year:{$year:"$txndate"}},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.month":1}}],(function(t,o){t?n(new Error(t)):e.json(o)})):"Year"===t.body.type&&s.aggregate([{$match:{txndate:{$gte:a,$lte:r}}},{$group:{_id:{txntype:"$txntype",year:{$year:"$txndate"}},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.year":1}}],(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.post("*/account/detailsReport",(function(t,e,n){var a={data:"",totalAmount:0},r=new Date(o(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),i=new Date(o(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));try{s.aggregate([{$match:{txndate:{$gte:r,$lte:i},txntype:{$eq:t.body.txnType},amount:{$ne:0}}},{$group:{_id:{type:"$type",txntype:"$txntype"},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.type":1}}],(function(t,o){if(t)n(new Error(t));else{a.data=o;var s=0;o.forEach((function(t){s+=t.totalAmount})),a.totalAmount=s,e.status(200).json(a)}}))}catch(t){n(new Error(t))}})),a.post("*/account/receiptDetails",(function(t,e,n){try{1===t.body.count?s.findById(t.body.ids,(function(t,n){n?e.status(200).json(n):e.status(404).send("Data not found")})):s.find({_id:{$in:t.body.ids.split(",")},isReceipt:!0},(function(t,n){n?e.status(200).json(n):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),a.post("*/account/daybookLedger",(function(t,e,n){try{var a=new Date(o(t.body.fromDate).format("YYYY-MM-DD")),r={totalIncome:0,totalExp:0,ledger:[]},i=0,c=0;s.find({txndate:a,amount:{$ne:0}},null,{sort:{type:1}},(function(t,o){t?n(new Error(t)):(o.forEach((function(t){let e={type:t.type,txntype:t.txntype,amount:t.amount,bankName:t.bankName,_id:t._id};"Income"===t.txntype?i+=t.amount:c+=-1*t.amount,r.ledger.push(e)})),r.totalIncome=i,r.totalExp=c,e.status(200).json(r))}))}catch(t){n(new Error(t))}})),a.post("*/account/daybookBalance",(function(t,e,n){try{var a,r,c=new Date(o(t.body.fromDate).format("YYYY-MM-DD"));s.aggregate([{$match:{txndate:{$lt:c}}},{$group:{_id:{bankName:"$bankName"},totalAmount:{$sum:"$amount"}}}],(function(t,o){t?n(new Error(t)):(a=o,s.aggregate([{$match:{txndate:{$lte:c}}},{$group:{_id:{bankName:"$bankName"},totalAmount:{$sum:"$amount"}}}],(function(t,o){if(t)n(new Error(t));else{r=o;var s=[];i.find((function(t,n){n.forEach((function(t){let e,n,o=0,i=0;"Cash In Hand"===t.name?(e=a.filter(t=>""===t._id.bankName)[0],n=r.filter(t=>""===t._id.bankName)[0]):(e=a.filter(e=>e._id.bankName===t.name)[0],n=r.filter(e=>e._id.bankName===t.name)[0]),null!=e&&(o=e.totalAmount),null!=n&&(i=n.totalAmount);let c={bankName:t.name,openingBal:o,closingBal:i};s.push(c)})),e.status(200).json(s)}))}})))}))}catch(t){n(new Error(t))}})),a.post("*/account/monthlyBalance",(function(t,e,n){var a={cash:[],openSum:0,closeSum:0};try{var r,c,d=new Date(o(t.body.fromDate).format("YYYY-MM-DD")),u=new Date(o(t.body.toDate).format("YYYY-MM-DD")),p=0,m=0;s.aggregate([{$match:{txndate:{$lt:d}}},{$group:{_id:{bankName:"$bankName"},totalAmount:{$sum:"$amount"}}}],(function(t,o){t?n(new Error(t)):(r=o,s.aggregate([{$match:{txndate:{$lte:u}}},{$group:{_id:{bankName:"$bankName"},totalAmount:{$sum:"$amount"}}}],(function(t,o){if(t)n(new Error(t));else{c=o;var s=[];i.find((function(t,n){n.forEach((function(t){let e,n,o=0,a=0;"Cash In Hand"===t.name?(e=r.filter(t=>""===t._id.bankName)[0],n=c.filter(t=>""===t._id.bankName)[0]):(e=r.filter(e=>e._id.bankName===t.name)[0],n=c.filter(e=>e._id.bankName===t.name)[0]),null!=e&&(o=e.totalAmount),null!=n&&(a=n.totalAmount),p+=o,m+=a;let i={bankName:t.name,openingBal:o,closingBal:a};s.push(i)})),a.cash=s,a.openSum=p,a.closeSum=m,e.status(200).json(a)}))}})))}))}catch(t){n(new Error(t))}})),a.post("*/account/processCheque",(function(t,e,n){try{s.findById(t.body._id,(function(t,n){n?(n.amount=n.chAmount,n.txndate=o(new Date).format("YYYY-MM-DD"),n.save().then(t=>{e.status(200).json("Update complete")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),a.post("*/account/chequeReport",(function(t,e,n){try{var o;switch(t.body.status){case"All":o={bankMode:"Cheque"};break;case"Pending":o={bankMode:"Cheque",amount:0};break;case"Cleared":o={bankMode:"Cheque",amount:{$ne:0}}}s.find(o,(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),t.exports=a},function(t,e,n){const o=n(0).Router();let a=n(10),s=n(43);const r=n(2);let i=n(4);function c(t){let e=new s;e.txnDate=r(new Date).format("YYYY-MM-DD"),e.mno=t.mno,e.medName=t.medName,e.txnType=t.txnType,e.desc=t.desc,e.openingMain=t.openingMain,e.openingSub=t.openingSub,e.openingAKit=t.openingAKit,e.openingBKit=t.openingBKit,e.qty=t.qty,e.closingMain=t.closingMain,e.closingSub=t.closingSub,e.closingAKit=t.closingAKit,e.closingBKit=t.closingBKit,e.pno=t.pno,e.patientName=t.patientName,e.save()}function d(t,e){var n=0,o=0,s=0,r=0;a.findOne({mno:t.body.mno},(function(a,i){if(i){let e=parseInt(t.body.qty);n=i.stock.main,o=i.stock.sub,s=i.stock.a_kit,r=i.stock.b_kit,i.stock.sub=parseInt(i.stock.sub)-e,"A Kit"===t.body.transferto?i.stock.a_kit=(isNaN(parseInt(i.stock.a_kit))?0:parseInt(i.stock.a_kit))+parseInt(t.body.qty):"B Kit"===t.body.transferto&&(i.stock.b_kit=(isNaN(parseInt(i.stock.b_kit))?0:parseInt(i.stock.b_kit))+parseInt(t.body.qty)),i.purchase.filter(t=>t.subStock>0&&null!=t.expdate).sort((t,e)=>t.expdate-e.expdate).forEach((function(t){e>0&&(t.subStock<=e?(e-=t.subStock,t.subStock=0):(t.subStock-=e,e=0),t.save({suppressWarning:!0}))})),i.save();var d="",u="";if("OP"===t.body.transferto){let e=t.body.patient.split("] ");d=e[0].replace("[",""),u=e[1]}c({mno:i.mno,medName:i.name,txnType:"Transfer",desc:"Sub to "+t.body.transferto,openingMain:n,openingSub:o,openingAKit:s,openingBKit:r,qty:t.body.qty,closingMain:i.stock.main,closingSub:i.stock.sub,closingAKit:i.stock.a_kit,closingBKit:i.stock.b_kit,pno:d,patientName:u})}else e.status(404).send("Data not found")}))}o.post("*/medicine/add",(function(t,e,n){try{let n=new a(t.body);a.findOne({name_lower:n.name.toLowerCase()},(function(t,o){o?e.status(200).json("Duplicate Medicine !!"):new Promise((function(t,e){a.countDocuments((function(e,n){var o=++n;t("M"+o)}))})).then((function(t){n.mno=t,n.name_lower=n.name.toLowerCase(),n.purchase[0].invdate=null!==n.purchase[0].invdate?r(n.purchase[0].invdate).format("YYYY-MM-DD"):null,n.purchase[0].expdate=null!==n.purchase[0].expdate?r(n.purchase[0].expdate).format("YYYY-MM-DD"):null,n.purchase[0].mfgdate=null!==n.purchase[0].mfgdate?r(n.purchase[0].mfgdate).format("YYYY-MM-DD"):null,n.save(),e.status(200).json("Medicine Added !!"),c({mno:n.mno,medName:n.name,txnType:"Add",desc:"To main stock",openingMain:0,openingSub:0,openingAKit:0,openingBKit:0,qty:n.stock.main,closingMain:n.stock.main,closingSub:0,closingAKit:0,closingBKit:0,pno:"",patientName:""})}))}))}catch(t){n(new Error(t))}})),o.get("*/medicine",(function(t,e,n){a.find({},null,{sort:{name:1}},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),o.get("*/medicine/edit/:id",(function(t,e){let n=t.params.id;a.findById(n,(function(t,n){e.status(200).json(n)}))})),o.post("*/medicine/update/:id",(function(t,e,n){try{a.findById(t.params.id,(function(n,o){o?(o.name=t.body.name,o.name_lower=o.name.toLowerCase(),o.save().then(t=>{e.status(200).json("Update completed")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),o.get("*/medicine/delete/:id",(function(t,e){a.findOneAndDelete({_id:t.params.id},(function(t,n){t?e.json(t):e.json("Successfully removed")}))})),o.get("*/medicine/getNames",(function(t,e,n){a.find({},{_id:0,mno:1,name:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),o.get("*/medicine/getStock/:mno",(function(t,e,n){a.findOne({mno:t.params.mno},{_id:0,stock:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),o.get("*/medicine/getDetails/:mno",(function(t,e,n){a.findOne({mno:t.params.mno},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),o.get("*/medicine/getPurchaseDetails/:mno",(function(t,e,n){a.findOne({mno:t.params.mno},{},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),o.post("*/medicine/getHistory",(function(t,e,n){console.log(t.body);let o=r(t.body.fromDate).format("YYYY-MM-DD"),a=r(t.body.toDate).format("YYYY-MM-DD");console.log(o),console.log(a),s.find({mno:t.body.mno,txnDate:{$gte:o,$lte:a}},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),o.post("*/medicine/transfer",(function(t,e,n){try{"Sub Stock"===t.body.stocktype?d(t,e):function(t,e){var n=0,o=0,s=0,r=0;a.findOne({mno:t.body.mno},(function(a,i){if(i){let e=parseInt(t.body.qty);n=i.stock.main,o=i.stock.sub,s=i.stock.a_kit,r=i.stock.b_kit,i.stock.main=parseInt(i.stock.main)-e,i.stock.sub=parseInt(i.stock.sub)+e,i.purchase.filter(t=>t.mainStock>0&&null!=t.expdate).sort((t,e)=>t.expdate-e.expdate).forEach((function(t){e>0&&(t.mainStock<=e?(t.subStock+=t.mainStock,e-=t.mainStock,t.mainStock=0):(t.subStock+=e,t.mainStock-=e,e=0),t.save({suppressWarning:!0}))})),i.save(),c({mno:i.mno,medName:i.name,txnType:"Transfer",desc:"Main to Sub",openingMain:n,openingSub:o,openingAKit:s,openingBKit:r,qty:t.body.qty,closingMain:i.stock.main,closingSub:i.stock.sub,closingAKit:i.stock.a_kit,closingBKit:i.stock.b_kit,pno:"",patientName:""})}else e.status(404).send("Data not found")}))}(t,e),e.status(200).json("Medicine Transferred")}catch(t){n(new Error(t))}})),o.post("*/medicine/transferOP",(function(t,e,n){try{d(t),e.status(200).json("Medicine Transferred")}catch(t){n(new Error(t))}})),o.post("*/medicine/transferKit",(function(t,e,n){try{!function(t,e){var n=0,o=0,s=0,r=0;a.findOne({mno:t.body.mno},(function(a,i){if(i){n=i.stock.main,o=i.stock.sub,s=i.stock.a_kit,r=i.stock.b_kit,"A Kit"===t.body.stocktype?i.stock.a_kit=parseInt(i.stock.a_kit)-parseInt(t.body.qty):i.stock.b_kit=parseInt(i.stock.b_kit)-parseInt(t.body.qty),i.save();let e=t.body.patient.split("] "),a=e[0].replace("[",""),d=e[1];c({mno:i.mno,medName:i.name,txnType:"Transfer",desc:t.body.stocktype+" to OP",openingMain:n,openingSub:o,openingAKit:s,openingBKit:r,qty:t.body.qty,closingMain:i.stock.main,closingSub:i.stock.sub,closingAKit:i.stock.a_kit,closingBKit:i.stock.b_kit,pno:a,patientName:d})}else e.status(404).send("Data not found")}))}(t),e.status(200).json("Medicine Transferred")}catch(t){n(new Error(t))}})),o.post("*/medicine/inbound",(function(t,e,n){try{var o=0,s=0,i=0,d=0;a.findOne({mno:t.body.mno},(function(n,a){if(a){o=a.stock.main,s=a.stock.sub,i=a.stock.a_kit,d=a.stock.b_kit,a.stock.main=parseInt(a.stock.main)+parseInt(t.body.qty);let e=null!=t.body.purchase.invdate&&""!=t.body.purchase.invdate?r(t.body.purchase.invdate).format("YYYY-MM-DD"):null,n=null!=t.body.purchase.expdate&&""!=t.body.purchase.expdate?r(t.body.purchase.expdate).format("YYYY-MM-DD"):null;mfgdate=null!=t.body.purchase.mfgdate&&""!=t.body.purchase.mfgdate?r(t.body.purchase.mfgdate).format("YYYY-MM-DD"):null;const u={expdate:n,mfgdate:mfgdate,rate:t.body.purchase.rate,dealer:t.body.purchase.dealer,invdate:e,invno:t.body.purchase.invno,batchno:t.body.purchase.batchno,mainStock:t.body.purchase.qty,subStock:0};a.purchase.push(u),a.save(),c({mno:a.mno,medName:a.name,txnType:"Inbound",desc:"To main stock",openingMain:o,openingSub:s,openingAKit:i,openingBKit:d,qty:t.body.qty,closingMain:a.stock.main,closingSub:a.stock.sub,closingAKit:a.stock.a_kit,closingBKit:a.stock.b_kit,pno:"",patientName:""})}else e.status(404).send("Data not found")})),e.status(200).json("Medicine Added")}catch(t){n(new Error(t))}})),o.post("*/medicine/return",(function(t,e,n){try{var o=0,s=0,i=0,d=0;a.findOne({mno:t.body.mno},(function(n,a){if(a){o=a.stock.main,s=a.stock.sub,i=a.stock.a_kit,d=a.stock.b_kit,a.stock.main=parseInt(a.stock.main)-parseInt(t.body.mainRet),a.stock.sub=parseInt(a.stock.sub)-parseInt(t.body.subRet),a.purchase.filter(e=>e._id==t.body.purId).forEach((function(e){e.mainStock-=t.body.mainRet,e.subStock-=t.body.subRet,e.save({suppressWarning:!0})}));const e={expdate:null,mfgdate:null,rate:0,dealer:"",invdate:new Date(r(new Date).format("YYYY-MM-DD")),invno:"",batchno:"",mainStock:parseInt(t.body.mainRet)+parseInt(t.body.subRet),subStock:0,return:1};a.purchase.push(e),a.save(),c({mno:a.mno,medName:a.name,txnType:"Return",desc:"Return stock",openingMain:o,openingSub:s,openingAKit:i,openingBKit:d,qty:parseInt(t.body.mainRet)+parseInt(t.body.subRet),closingMain:a.stock.main,closingSub:a.stock.sub,closingAKit:a.stock.a_kit,closingBKit:a.stock.b_kit,pno:"",patientName:""})}else e.status(404).send("Data not found")})),e.status(200).json("Medicine Returned")}catch(t){n(new Error(t))}})),o.post("*/medicine/updateStock",(function(t,e,n){try{console.log(t.body);var o=0,s=0,r=0,i=0;a.findOne({mno:t.body.mno},(function(n,a){if(a){o=a.stock.main,s=a.stock.sub,r=a.stock.a_kit,i=a.stock.b_kit,a.stock.main=parseInt(a.stock.main)-parseInt(t.body.mainDiff),a.stock.sub=parseInt(a.stock.sub)-parseInt(t.body.subDiff),a.purchase.filter(e=>e._id==t.body.purId).forEach((function(e){e.mainStock=t.body.mainNew,e.subStock=t.body.subNew,e.save({suppressWarning:!0})})),a.save(),c({mno:a.mno,medName:a.name,txnType:"Edit",desc:"Edit stock",openingMain:o,openingSub:s,openingAKit:r,openingBKit:i,qty:0,closingMain:a.stock.main,closingSub:a.stock.sub,closingAKit:a.stock.a_kit,closingBKit:a.stock.b_kit,pno:"",patientName:""}),e.status(200).json("Medicine Update")}else e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),o.get("*/medicine/reportExpiry",(function(t,e,n){i.findOne((function(t,o){var s=new Date(r(new Date).format("YYYY-MM-DD")),i=new Date(r((new Date).setTime((new Date).getTime()+864e5*o.medExpiryDays)).format("YYYY-MM-DD"));a.aggregate([{$unwind:"$purchase"},{$unwind:"$purchase.expdate"},{$match:{"purchase.expdate":{$gte:s,$lte:i},$or:[{"purchase.mainStock":{$gt:0}},{"purchase.subStock":{$gt:0}}]}},{$group:{_id:{_id:"$_id",name:"$name",mno:"$mno",expDate:"$purchase.expdate",mainStock:"$purchase.mainStock",subStock:"$purchase.subStock"}}},{$sort:{"_id.expDate":1}}],(function(t,o){t?n(new Error(t)):e.json(o)}))}))})),o.get("*/medicine/reportExpiryCount",(function(t,e,n){i.findOne((function(t,o){var s=new Date(r(new Date).format("YYYY-MM-DD")),i=new Date(r((new Date).setTime((new Date).getTime()+864e5*o.medExpiryDays)).format("YYYY-MM-DD"));a.aggregate([{$unwind:"$purchase"},{$unwind:"$purchase.expdate"},{$match:{"purchase.expdate":{$gte:s,$lte:i},$or:[{"purchase.mainStock":{$gt:0}},{"purchase.subStock":{$gt:0}}]}},{$group:{_id:null,count:{$sum:1}}}],(function(t,o){t?n(new Error(t)):e.json(o)}))}))})),o.get("*/medicine/reportThreshold",(function(t,e,n){i.findOne((function(t,o){a.aggregate([{$match:{"stock.main":{$gt:0,$lte:o.medThresholdCount}}},{$group:{_id:{name:"$name",mno:"$mno",mainStock:"$stock.main"}}},{$sort:{"_id.name":1}}],(function(t,o){t?n(new Error(t)):e.json(o)}))}))})),o.get("*/medicine/reportThresholdCount",(function(t,e,n){i.findOne((function(t,o){a.aggregate([{$unwind:"$purchase"},{$unwind:"$purchase.mainStock"},{$unwind:"$purchase.subStock"},{$match:{"purchase.mainStock":{$gt:0,$lte:o.medThresholdCount}}},{$group:{_id:null,count:{$sum:1}}}],(function(t,o){t?n(new Error(t)):e.json(o)}))}))})),t.exports=o},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({txnDate:{type:Date},mno:{type:String},medName:{type:String},txnType:{type:String},desc:{type:String},openingMain:{type:Number},openingSub:{type:Number},openingAKit:{type:Number},openingBKit:{type:Number},qty:{type:Number},closingMain:{type:Number},closingSub:{type:Number},closingAKit:{type:Number},closingBKit:{type:Number},pno:{type:String},patientName:{type:String}},{collection:"medicineHistory"});t.exports=o.model("medicineHistory",a)},function(t,e,n){const o=n(0).Router();let a=n(10),s=n(8);o.route("*/dashboard").get((function(t,e,n){try{let t;a.aggregate([{$group:{_id:null,main:{$sum:"$stock.main"},sub:{$sum:"$stock.sub"},a_kit:{$sum:"$stock.a_kit"},b_kit:{$sum:"$stock.b_kit"}}}],(function(o,a){o?n(new Error(o)):(t={stock:a},s.aggregate([{$group:{_id:"$grade",total:{$sum:1}}}],(function(o,a){o?n(new Error(o)):(t.grade=a,e.status(200).json(t))})))}))}catch(t){n(new Error(t))}})),t.exports=o},function(t,e,n){const o=n(0);var a=n(3);const s=o.Router();let r=n(6);s.post("*/bank/add",(function(t,e,n){try{let n=new r(t.body);new a((function(t,e){r.countDocuments((function(e,n){var o=++n;t("B"+o)}))})).then((function(t){n.bno=t,n.save()})),e.status(200).send("Success")}catch(t){n(new Error(t))}})),s.get("*/bank",(function(t,e,n){r.find((function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),s.get("*/bank/getBanks",(function(t,e,n){try{r.find((function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),s.get("*/bank/edit/:id",(function(t,e){let n=t.params.id;r.findById(n,(function(t,n){e.status(200).json(n)}))})),s.post("*/bank/update/:id",(function(t,e,n){try{r.findById(t.params.id,(function(n,o){o?(o.name=t.body.name,o.save().then(t=>{e.status(200).json("Update complete")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),s.get("*/bank/getBankName/:bank",(function(t,e,n){try{r.findOne({bno:t.params.bank},(function(t,n){n?e.status(200).json(n.name):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),s.get("*/bank/delete/:id",(function(t,e){r.findOneAndDelete({_id:t.params.id},(function(t,n){t?e.json(t):e.json("Successfully removed")}))})),t.exports=s},function(t,e,n){const o=n(0);n(3);const a=o.Router();let s=n(11);const r=n(2);a.post("*/cashBalance/save",(function(t,e,n){try{let n=new s(t.body);n.month=r(n.month).format("YYYY-MM-DD"),s.findOne({month:n.month},(function(t,o){o?(Object.values(n.balance).forEach((function(t){if(null!=t.bno){var e=!1;Object.values(o.balance).forEach((function(n){null!=n.bno&&n.bno==t.bno&&(n.open=t.open,n.close=t.close,e=!0)})),e||o.balance.push({bno:t.bno,bankName:t.bankName,open:t.open,close:t.close})}})),o.save().then(e.status(200).send("Success"))):n.save().then(e.status(200).send("Success"))}))}catch(t){n(new Error(t))}})),a.post("*/cashBalance/load",(function(t,e,n){try{var o=new Date(r(t.body.month).format("YYYY-MM-DD"));s.findOne({month:o},(function(t,n){e.status(200).json(n)}))}catch(t){n(new Error(t))}})),a.get("*/cashBalance",(function(t,e,n){IncomeType.find((function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),t.exports=a},function(t,e,n){const o=n(0).Router();let a=n(11);const s=n(2);o.post("*/report/monthly",(function(t,e,n){try{var o={cash:[],openSum:0,closeSum:0},r=new Date(s(t.body.fromDate).format("YYYY-MM-DD")),i=new Date(s(new Date(s(t.body.toDate).get("year"),s(t.body.toDate).get("month"),1)).format("YYYY-MM-DD"));a.find({$or:[{month:r},{month:i}]},null,{sort:{month:1}},(function(t,n){var a=0,s=0;n?1===n.length?(n[0].balance.forEach((function(t){a+=t.open,s+=t.close})),o.openSum=a,o.closeSum=s,o.cash=n[0].balance):(n[0].balance.forEach((function(t){a+=t.open})),o.openSum=a,n[1].balance.forEach((function(t){s+=t.close})),o.closeSum=s,n[0].balance.forEach((function(t){var e=0,a=n[1].balance.filter(e=>e.bno===t.bno)[0];null!=a&&(e=a.close);var s={_id:t._id,bankName:t.bankName,open:t.open,close:e};o.cash.push(s)}))):e.status(200).json("NA"),e.status(200).json(o)}))}catch(t){n(new Error(t))}})),t.exports=o},function(t,e,n){const o=n(0).Router();let a=n(49),s=n(50);const r=n(2);o.post("*/equipment/add",(function(t,e,n){try{let n=new a(t.body);a.findOne({name_lower:n.name.toLowerCase()},(function(e,o){o?(o.stock.inuse=parseInt(t.body.stock.inuse),o.stock.damage=parseInt(t.body.stock.damage),o.stock.stock=parseInt(t.body.stock.stock),o.save()):new Promise((function(t,e){a.countDocuments((function(e,n){var o=++n;t("E"+o)}))})).then((function(t){n.eno=t,n.name_lower=n.name.toLowerCase(),n.save()}))})),e.status(200).json("Equipment added")}catch(t){n(new Error(t))}})),o.post("*/equipment/dispose",(function(t,e,n){try{a.findById(t.body.eid,(function(n,o){if(o){let n=new s(t.body);n.txnDate=r(new Date).format("YYYY-MM-DD"),n.save().then(a=>{o.stock.damage-=t.body.qty,o.save().then(t=>{e.status(200).json(n._id)})})}else e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),o.get("*/equipment",(function(t,e,n){a.find({},null,{sort:{name:1}},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),o.get("*/equipment/edit/:id",(function(t,e){let n=t.params.id;a.findById(n,(function(t,n){e.status(200).json(n)}))})),o.post("*/equipment/update/:id",(function(t,e,n){try{a.findById(t.params.id,(function(n,o){o?(o.name=t.body.name,o.name_lower=o.name.toLowerCase(),o.stock.inuse=t.body.stock.inuse,o.stock.stock=t.body.stock.stock,o.stock.damage=t.body.stock.damage,o.save()):e.status(404).send("Data not found")})),e.status(200).json("Update completed")}catch(t){n(new Error(t))}})),o.get("*/equipment/getNames",(function(t,e,n){a.find({},{_id:0,eno:1,name:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),o.get("*/equipment/getStock/:eno",(function(t,e,n){a.findOne({eno:t.params.eno},{_id:0,stock:1},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),o.get("*/equipment/tracker/:eno",(function(t,e,n){a.findOne({eno:t.params.eno},{},(function(t,o){if(t)n(new Error(t));else{var a=o.tracker.filter(t=>null===t.indate);e.status(200).json(a)}}))})),o.post("*/equipment/transfer",(function(t,e,n){try{a.findOne({eno:t.body.eno},(function(n,o){if(o){o.stock.stock=parseInt(o.stock.stock)-parseInt(t.body.qty),o.stock.inuse=parseInt(o.stock.inuse)+parseInt(t.body.qty);const e={patientname:t.body.patientname,qty:t.body.qty,outdate:t.body.outdate,indate:null};e.outdate=r(e.outdate).format("YYYY-MM-DD"),o.tracker.push(e),o.save()}else e.status(404).send("Data not found")})),e.status(200).json("Equipment Transferred")}catch(t){n(new Error(t))}})),o.post("*/equipment/return",(function(t,e,n){try{a.findOne({eno:t.body.eno},(function(e,n){n.stock.stock=parseInt(n.stock.stock)+parseInt(t.body.qty),n.stock.inuse=parseInt(n.stock.inuse)-parseInt(t.body.qty),n.tracker.forEach((function(e){e._id==t.body._id&&(e.indate=t.body.indate,e.indate=r(e.indate).format("YYYY-MM-DD"),n.save())}))})),e.status(200).json("Equipment Returned")}catch(t){n(new Error(t))}})),o.post("*/equipment/report",(function(t,e,n){var o=[];""===t.body.eno?a.find({},null,{sort:{name:1}},(function(t,o){t?n(new Error(t)):e.status(200).json(o)})):a.findOne({eno:t.body.eno},(function(t,a){t?n(new Error(t)):(o.push(a),e.status(200).json(o))}))})),o.post("*/equipment/disposeDetails",(function(t,e,n){console.log(t.body);try{1===t.body.count?s.findById(t.body.ids,(function(t,n){n?e.status(200).json(n):e.status(404).send("Data not found")})):s.find({_id:{$in:t.body.ids.split(",")}},(function(t,n){n?e.status(200).json(n):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),o.post("*/equipment/disposeList",(function(t,e,n){var o=new Date(r(t.body.fromDate).format("YYYY-MM-DD")),a=new Date(r(t.body.toDate).format("YYYY-MM-DD"));s.find({txnDate:{$gte:o,$lte:a}},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),t.exports=o},function(t,e,n){const o=n(1),a=o.Schema;let s=new a({stock:{type:Number},damage:{type:Number},inuse:{type:Number}}),r=new a({patientname:{type:String},qty:{type:Number},outdate:{type:Date},indate:{type:Date}}),i=new a({eno:{type:String},name:{type:String},name_lower:{type:String},stock:s,tracker:[r]},{collection:"equipment"});t.exports=o.model("equipment",i)},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({eno:{type:String},name:{type:String},desc:{type:String},qty:{type:Number},txnDate:{type:Date}},{collection:"equipmentDispose"});t.exports=o.model("equipmentDispose",a)},function(t,e,n){const o=n(0).Router();let a=n(52),s=n(6);const r=n(2);o.post("*/bankLedger/add",(function(t,e,n){try{let n=new a(t.body);null!=n.txnDate&&""!=n.txnDate&&(n.txnDate=r(n.txnDate).format("YYYY-MM-DD")),n.save().then(e.status(200).send("Success"))}catch(t){n(new Error(t))}})),o.get("*/bankLedger/:bno",(function(t,e,n){a.find({bno:t.params.bno},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),o.get("*/bankLedger/getBalance/:bno",(function(t,e,n){a.aggregate([{$match:{bno:{$eq:t.params.bno}}},{$group:{_id:null,balance:{$sum:"$amount"}}}],(function(t,o){t?n(new Error(t)):e.json(o)}))})),o.post("*/bankLedger/update/:id",(function(t,e,n){try{a.findById(t.params.id,(function(n,o){o?(o.txnType=t.body.txnType,o.amount=t.body.amount,o.save().then(t=>{e.status(200).json("Update completed")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),o.post("*/bankLedger/daybookBalance",(function(t,e,n){try{var o,i,c=new Date(r(t.body.fromDate).format("YYYY-MM-DD"));a.aggregate([{$match:{txnDate:{$lt:c}}},{$group:{_id:{bno:"$bno"},totalAmount:{$sum:"$amount"}}}],(function(t,r){t?n(new Error(t)):(o=r,a.aggregate([{$match:{txnDate:{$lte:c}}},{$group:{_id:{bno:"$bno"},totalAmount:{$sum:"$amount"}}}],(function(t,a){if(t)n(new Error(t));else{i=a;var r=[];s.find({cash:!1},(function(t,n){n.forEach((function(t){let e=0,n=0,a=o.filter(e=>e._id.bno===t.bno)[0],s=i.filter(e=>e._id.bno===t.bno)[0];null!=a&&(e=a.totalAmount),null!=s&&(n=s.totalAmount);let c={bankName:t.name,openingBal:e,closingBal:n};r.push(c)})),e.status(200).json(r)}))}})))}))}catch(t){n(new Error(t))}})),o.post("*/bankLedger/daybookLedger",(function(t,e,n){try{var o=new Date(r(t.body.fromDate).format("YYYY-MM-DD")),i={totalDeposit:0,totalWithdraw:0,ledger:[]},c=0,d=0;a.find({txnDate:o},null,{sort:{bno:1}},(function(t,o){t?n(new Error(t)):s.find({cash:!1},(function(t,n){o.forEach((function(t){let e="",o=n.filter(e=>e.bno===t.bno)[0];null!=o&&(e=o.name);let a={bankName:e,txnType:t.txnType,amount:t.amount,_id:t._id};"Deposit"===t.txnType?c+=t.amount:d+=-1*t.amount,i.ledger.push(a)})),i.totalDeposit=c,i.totalWithdraw=d,e.status(200).json(i)}))}))}catch(t){n(new Error(t))}})),t.exports=o},function(t,e,n){const o=n(1);let a=new(0,o.Schema)({bno:{type:String},txnType:{type:String},txnDate:{type:Date},amount:{type:Number}},{collection:"bankLedger"});t.exports=o.model("bankLedger",a)},function(t,e,n){const o=n(2),a=n(0).Router();let s=n(9);a.post("*/receipt/add",(function(t,e,n){try{let n=new s(t.body);n.txndate=o(n.txndate).tz("Asia/Calcutta").format("YYYY-MM-DD"),n.save().then(e.status(200).send("Success"))}catch(t){n(new Error(t))}})),a.post("*/receipt",(function(t,e,n){var a=new Date(o(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),r=new Date(o(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));s.find({$or:[{txntype:"Voucher"},{txntype:"Receipt"}],txndate:{$gte:a,$lte:r}},(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))})),a.get("*/receipt/edit/:id",(function(t,e){let n=t.params.id;s.findById(n,(function(t,n){e.status(200).json(n)}))})),a.post("*/receipt/update/:id",(function(t,e,n){try{s.findById(t.params.id,(function(n,o){o?(o.desc=t.body.desc,o.name=t.body.name,o.amount=t.body.amount,"Receipt"===o.txntype&&(o.type=t.body.type),o.save().then(t=>{e.status(200).json("Update complete")})):e.status(404).send("Data not found")}))}catch(t){n(new Error(t))}})),a.post("*/account/summaryReport",(function(t,e,n){var a=new Date(o(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),r=new Date(o(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));try{"Date"===t.body.type?s.aggregate([{$match:{txndate:{$gte:a,$lte:r}}},{$group:{_id:{txntype:"$txntype",txndate:"$txndate"},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.txndate":1}}],(function(t,o){t?n(new Error(t)):e.json(o)})):"Month"===t.body.type?s.aggregate([{$match:{txndate:{$gte:a,$lte:r}}},{$group:{_id:{txntype:"$txntype",month:{$month:"$txndate"},year:{$year:"$txndate"}},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.month":1}}],(function(t,o){t?n(new Error(t)):e.json(o)})):"Year"===t.body.type&&s.aggregate([{$match:{txndate:{$gte:a,$lte:r}}},{$group:{_id:{txntype:"$txntype",year:{$year:"$txndate"}},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.year":1}}],(function(t,o){t?n(new Error(t)):e.status(200).json(o)}))}catch(t){n(new Error(t))}})),a.post("*/account/detailsReport",(function(t,e,n){var a={data:"",totalAmount:0},r=new Date(o(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),i=new Date(o(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));try{s.aggregate([{$match:{txndate:{$gte:r,$lte:i},txntype:{$eq:t.body.txnType}}},{$group:{_id:{type:"$type",txntype:"$txntype"},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.type":1}}],(function(t,o){if(t)n(new Error(t));else{a.data=o;var s=0;o.forEach((function(t){s+=t.totalAmount})),a.totalAmount=s,e.status(200).json(a)}}))}catch(t){n(new Error(t))}})),t.exports=a},function(t,e,n){const o=n(1);n(12).config();let a="mongodb://pnpadmin:"+n(5).getCrytoHelperInstance().decryptField("b07d11be61d08671cf5a24bf89be84121a5d08fea1f86c54954b")+"@localhost:27017/PnP";o.Promise=global.Promise,o.connect(a,{useNewUrlParser:!0}).then(()=>{console.log("Database is connected..")},t=>{console.log("Can not connect to the database"+t)})}]);