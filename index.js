!function(t){var n={};function e(a){if(n[a])return n[a].exports;var o=n[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,a){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:a})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(a,o,function(n){return t[n]}.bind(null,o));return a},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=13)}([function(t,n){t.exports=require("express")},function(t,n){t.exports=require("mongoose")},function(t,n){t.exports=require("moment-timezone")},function(t,n){t.exports=require("promise")},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({name:{type:String},desc:{type:String},location:{type:String},regno:{type:String},address:{type:String},phone:{type:String},nameMal:{type:String},descMal:{type:String},locationMal:{type:String},addressMal:{type:String},receiptNo:{type:Number},medExpiryDays:{type:Number},medThresholdCount:{type:Number},validTill:{type:String},todayAPI:{type:String}},{collection:"centerDetails"});t.exports=a.model("centerDetails",o)},function(t,n,e){const{createLogger:a,format:o,transports:s}=e(18);e(19);const r=e(20),i=e(21),c=function(){r.existsSync(i.LOG_DIRECTORY)||r.mkdirSync(i.LOG_DIRECTORY);let t=null;const n=new s.DailyRotateFile({filename:i.LOG_FILE_NAME,dirname:i.LOG_DIRECTORY,datePattern:i.LOG_FILE_NAME_DATE_PATTERN,json:!0,format:o.combine(o.label({label:i.LOG_LABEL}),o.timestamp(),o.prettyPrint())}),e=a({format:o.combine(o.label(i.LOG_LABEL),o.timestamp({format:i.LOG_IN_CONSOLE_TIMESTAMP_PATTERN}),o.printf(t=>`${t.timestamp} ${t.level} ${t.message}`)),transports:[new s.Console,n],exceptionHandlers:[new s.File({filename:i.LOG_FATAL_FAILURE_FILE_NAME,dirname:i.LOG_DIRECTORY})],exitOnError:!1});return{getLoggerInstance:()=>(null==t&&(t={log:(t,n)=>{setTimeout(()=>{e.log(t,n)},100)}}),t)}}();t.exports=c},function(t,n,e){const a=e(23),o=function(){const t=new a("SJuPDE*dT12j$*n");let n=null;return{getCrytoHelperInstance:()=>(null==n&&(n={encryptField:n=>t.encrypt(n.toString()),decryptField:n=>t.decrypt(n)}),n)}}();t.exports=o},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({bno:{type:String},name:{type:String},cash:{type:Boolean,default:"0"}},{collection:"bank"});t.exports=a.model("bank",o)},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({pno:{type:String},name:{type:String},age:{type:String},address:{type:String},grade:{type:String},gender:{type:String},panjayath:{type:String},wardno:{type:String},phone1:{type:String},phone2:{type:String},regdate:{type:Date},expdate:{type:Date},dropdate:{type:Date},volunteer:{type:String},diagnosis:{type:String},temp:{type:Boolean}},{collection:"patient"});t.exports=a.model("Patient",o)},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({txndate:{type:Date},desc:{type:String},type:{type:String},amount:{type:Number},txntype:{type:String},name:{type:String},receiptNo:{type:String},isReceipt:{type:Boolean},paymentMode:{type:String},bankMode:{type:String},bankName:{type:String},txnNo:{type:String},chNo:{type:String},chdate:{type:Date},chBank:{type:String},chAmount:{type:Number}},{collection:"account"});t.exports=a.model("account",o)},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({mno:{type:String},name:{type:String},name_lower:{type:String},stock:{main:{type:Number},sub:{type:Number},a_kit:{type:Number},b_kit:{type:Number}},purchase:[{invdate:{type:Date},invno:{type:String},batchno:{type:String},expdate:{type:Date},mfgdate:{type:Date},rate:{type:Number},dealer:{type:String},mainStock:{type:Number},subStock:{type:Number},return:{type:Number}}]},{collection:"medicine"});t.exports=a.model("medicine",o)},function(t,n,e){const a=e(1),o=a.Schema;let s=new o({bankName:{type:String},bno:{type:String},open:{type:Number},close:{type:Number}}),r=new o({month:{type:Date},balance:{type:[s]}},{collection:"cashBalance"});t.exports=a.model("cashBalance",r)},function(t,n){t.exports=require("dotenv")},function(t,n,e){t.exports=e(14)},function(t,n,e){const a=e(0)(),o=e(15),s=e(16);var r=e(17),i=e(27);e(52);const c=e(5).getLoggerInstance();e(12).config(),a.use(s()),a.use(o.urlencoded({extended:!0})),a.use(o.json()),a.use(r),a.use(i),a.use((function(t,n,e,a){c.log("error",`${t}`),e.status(500).send(JSON.stringify({status:500,message:"Something went wrong.",detail:t.message}))})),a.listen(process.env.PORT,(function(){console.log("Server is running on Port:",process.env.PORT)})),t.exports=a},function(t,n){t.exports=require("body-parser")},function(t,n){t.exports=require("cors")},function(t,n,e){var a=e(0).Router();const o=e(5).getLoggerInstance();var s=e(22),r=e(25);a.use((t,n,e)=>{o.log("info","Called : "+t.path),e()}),a.use(s),a.use(r),t.exports=a},function(t,n){t.exports=require("winston")},function(t,n){t.exports=require("winston-daily-rotate-file")},function(t,n){t.exports=require("fs")},function(t,n){t.exports={LOG_LABEL:"PnP Service",LOG_DIRECTORY:"logs",LOG_FILE_NAME:"logs-%DATE%.log",LOG_FILE_NAME_DATE_PATTERN:"YYYY_MM_DD",LOG_IN_CONSOLE_TIMESTAMP_PATTERN:"YYYY-MM-DD HH:mm:ss",LOG_FATAL_FAILURE_FILE_NAME:"fatal_failures.log"}},function(t,n,e){const a=e(0).Router();let o=e(4);const s=e(6).getCrytoHelperInstance(),r=e(2);a.get("*/center/getName",(function(t,n,e){try{o.findOne((function(t,e){n.json(e.name)}))}catch(t){e(new Error(t))}})),a.get("*/center/edit",(function(t,n,e){try{o.findOne((function(t,e){e.validTill=s.decryptField(e.validTill),e.todayAPI=r(new Date(s.decryptField(e.todayAPI))).format("YYYY-MM-DD"),n.json(e)}))}catch(t){e(new Error(t))}})),a.post("*/center/update/:id",(function(t,n,e){try{o.findById(t.params.id,(function(e,a){a?(a.name=t.body.name,a.desc=t.body.desc,a.location=t.body.location,a.regno=t.body.regno,a.address=t.body.address,a.phone=t.body.phone,a.nameMal=t.body.nameMal,a.descMal=t.body.descMal,a.locationMal=t.body.locationMal,a.addressMal=t.body.addressMal,a.medExpiryDays=t.body.medExpiryDays,a.medThresholdCount=t.body.medThresholdCount,a.save().then(t=>{n.json("Update complete")})):n.status(404).send("data is not found")}))}catch(t){e(new Error(t))}})),a.get("*/center/updateTime",(function(t,n,a){try{e(24)("http://worldtimeapi.org/api/timezone/Asia/Kolkata",(function(t,e,a){if(!t&&200==e.statusCode){var i=JSON.parse(a),c=new Date(r(i.utc_datetime).format("YYYY-MM-DD"));o.findOne((function(t,e){e.todayAPI=s.encryptField(c),e.save(),n.json(c)}))}}))}catch(t){a(new Error(t))}})),t.exports=a},function(t,n){t.exports=require("cryptr")},function(t,n){t.exports=require("request")},function(t,n,e){const a=e(0).Router();let o=e(26);const s=e(6).getCrytoHelperInstance();e(2);let r=e(4);a.post("*/login/validate",(function(t,n,e){try{console.log(s.encryptField("2020-10-31")),console.log(s.encryptField("paliative")),r.findOne((function(e,a){new Date(s.decryptField(a.todayAPI))<=new Date(s.decryptField(a.validTill))?o.findOne({username:t.body.username},(function(e,a){a&&t.body.password===s.decryptField(a.pwd)?n.status(200).send("Success"):n.status(204).send("Data not found")})):n.status(205).send("Account Expired")}))}catch(t){e(new Error(t))}})),t.exports=a},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({username:{type:String},pwd:{type:String}},{collection:"login"});t.exports=a.model("login",o)},function(t,n,e){var a=e(0).Router();const o=e(5).getLoggerInstance();var s=e(28),r=e(29),i=e(31),c=e(33),d=e(35),u=e(37),p=e(39),m=e(40),l=e(42),f=e(43),y=e(44),b=e(45),g=e(46),h=e(49),w=e(51);a.use((t,n,e)=>{o.log("info","Called : "+t.path),e()}),a.use(s),a.use(r),a.use(i),a.use(c),a.use(d),a.use(u),a.use(p),a.use(m),a.use(l),a.use(f),a.use(y),a.use(b),a.use(g),a.use(h),a.use(w),t.exports=a},function(t,n,e){const a=e(0);e(3);const o=a.Router(),s=e(2);let r=e(8);function i(t,n,e){e.pno=t.body.pno,e.name=t.body.name,e.age=t.body.age,e.address=t.body.address,e.grade=t.body.grade,e.gender=t.body.gender,e.panjayath=t.body.panjayath,e.wardno=t.body.wardno,e.phone1=t.body.phone1,e.phone2=t.body.phone2,e.volunteer=t.body.volunteer,e.diagnosis=t.body.diagnosis,e.temp=t.body.temp,null!=t.body.regdate&&""!=t.body.regdate&&"1970-01-01T00:00:00.000Z"!=t.body.regdate&&(e.regdate=s(t.body.regdate).tz("Asia/Calcutta").format("YYYY-MM-DD")),null!=t.body.expdate&&""!=t.body.expdate&&"1970-01-01T00:00:00.000Z"!=t.body.expdate&&(e.expdate=s(t.body.expdate).tz("Asia/Calcutta").format("YYYY-MM-DD")),null!=t.body.dropdate&&""!=t.body.dropdate&&"1970-01-01T00:00:00.000Z"!=t.body.dropdate?e.dropdate=s(t.body.dropdate).tz("Asia/Calcutta").format("YYYY-MM-DD"):e.dropdate=null,e.save().then(n.status(200).json("Update complete"))}o.post("*/Santhwanam/patient/add",(function(t,n,e){try{r.findOne({pno:t.body.pno},(function(e,a){if(a)n.status(204).send("Duplicate");else{let e=new r(t.body);null!=e.regdate&&""!=e.regdate&&(e.regdate=s(e.regdate).tz("Asia/Calcutta").format("YYYY-MM-DD")),null!=e.expdate&&""!=e.expdate&&(e.expdate=s(e.expdate).tz("Asia/Calcutta").format("YYYY-MM-DD")),null!=e.dropdate&&""!=e.dropdate&&(e.dropdate=s(e.dropdate).format("YYYY-MM-DD")),e.save().then(n.status(200).send("Success"))}}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/patient",(function(t,n,e){try{r.find({$or:[{temp:!1},{temp:void 0}],expdate:null,dropdate:null},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/patientFilter",(function(t,n,e){try{var a;switch(t.body.status){case"Active":a={expdate:{$eq:null},dropdate:{$eq:null},$or:[{temp:!1},{temp:void 0}]};break;case"Expired":a={expdate:{$ne:null}};break;case"Temp":a={temp:!0};break;case"Dropout":a={dropdate:{$ne:null}}}r.find(a,(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/patient/getNames",(function(t,n,e){try{r.find({$or:[{temp:!1},{temp:void 0}],expdate:null,dropdate:null},{_id:0,name:1,pno:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/patient/getAllNames",(function(t,n,e){try{r.find({expdate:null,dropdate:null},{_id:0,name:1,pno:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/patient/edit/:id",(function(t,n){let e=t.params.id;r.findById(e,(function(t,e){n.status(200).json(e)}))})),o.post("*/Santhwanam/patient/update/:id",(function(t,n,e){try{r.findById(t.params.id,(function(e,a){a?r.findOne({pno:t.body.pno},(function(e,o){o?o._id==t.params.id?i(t,n,a):n.status(204).send("Duplicate"):i(t,n,a)})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/patient/delete/:id",(function(t,n){r.findOneAndDelete({_id:t.params.id},(function(t,e){t?n.json(t):n.json("Successfully removed")}))})),o.post("*/Santhwanam/patient/detailsReport",(function(t,n,e){var a=new Date(s(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),o=new Date(s(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));try{if("Date"===t.body.type)r.aggregate([{$match:{regdate:{$gte:a,$lte:o},expdate:{$eq:null},dropdate:{$eq:null},$or:[{temp:!1},{temp:void 0}]}},{$sort:{name:1}}],(function(t,a){t?e(new Error(t)):n.status(200).json(a)}));else if("Grade"===t.body.type)r.aggregate([{$match:{grade:{$eq:t.body.gradeFilter},expdate:{$eq:null},dropdate:{$eq:null},$or:[{temp:!1},{temp:void 0}]}},{$sort:{name:1}}],(function(t,a){t?e(new Error(t)):n.status(200).json(a)}));else if("Status"===t.body.type){var i;switch(t.body.patStatus){case"All":i={pno:{$ne:null}};break;case"Active":i={expdate:{$eq:null},dropdate:{$eq:null},$or:[{temp:!1},{temp:void 0}]};break;case"Expired":i={expdate:{$ne:null}};break;case"Temp":i={temp:!0};break;case"Dropout":i={dropdate:{$ne:null}}}r.aggregate([{$match:i},{$sort:{name:1}}],(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}}catch(t){e(new Error(t))}})),t.exports=o},function(t,n,e){const a=e(0);var o=e(3);const s=a.Router();let r=e(30);s.post("*/Santhwanam/volunteer/add",(function(t,n,e){try{let e=new r(t.body);new o((function(t,n){r.countDocuments((function(n,e){var a=++e;t("V"+a)}))})).then((function(t){e.vno=t,e.save()})),n.status(200).send("Success")}catch(t){e(new Error(t))}})),s.get("*/Santhwanam/volunteer",(function(t,n,e){try{r.find((function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),s.get("*/Santhwanam/volunteer/getNames",(function(t,n,e){try{r.find({},{_id:0,name:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),s.get("*/Santhwanam/volunteer/edit/:id",(function(t,n){let e=t.params.id;r.findById(e,(function(t,e){n.json(e)}))})),s.post("*/Santhwanam/volunteer/update/:id",(function(t,n,e){try{r.findById(t.params.id,(function(e,a){a?(a.name=t.body.name,a.location=t.body.location,a.phone=t.body.phone,a.save().then(t=>{n.status(200).json("Update complete")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),s.get("*/Santhwanam/volunteer/delete/:id",(function(t,n){r.findOneAndDelete({_id:t.params.id},(function(t,e){t?n.json(t):n.json("Successfully removed")}))})),t.exports=s},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({vno:{type:String},name:{type:String},location:{type:String},phone:{type:String}},{collection:"volunteer"});t.exports=a.model("Volunteer",o)},function(t,n,e){const a=e(0);e(3);const o=a.Router();let s=e(32);o.post("*/Santhwanam/panjayath/add",(function(t,n,e){try{new s(t.body).save().then(n.status(200).send("Success"))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/panjayath",(function(t,n,e){try{s.find((function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/panjayath/getNames",(function(t,n,e){try{s.find({},{_id:0,name:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/panjayath/edit/:id",(function(t,n){let e=t.params.id;s.findById(e,(function(t,e){n.status(200).json(e)}))})),o.post("*/Santhwanam/panjayath/update/:id",(function(t,n,e){try{s.findById(t.params.id,(function(e,a){a?(a.name=t.body.name,a.save().then(t=>{n.status(200).json("Update complete")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/panjayath/delete/:id",(function(t,n){s.findOneAndDelete({_id:t.params.id},(function(t,e){t?n.json(t):n.json("Successfully removed")}))})),t.exports=o},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({name:{type:String}},{collection:"panjayath"});t.exports=a.model("panjayath",o)},function(t,n,e){const a=e(0);e(3);const o=a.Router();let s=e(34);o.post("*/Santhwanam/diagnosis/add",(function(t,n,e){try{new s(t.body).save().then(n.status(200).send("Success"))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/diagnosis",(function(t,n,e){try{s.find((function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/diagnosis/getNames",(function(t,n,e){try{s.find({},{_id:0,name:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/diagnosis/edit/:id",(function(t,n){let e=t.params.id;s.findById(e,(function(t,e){n.status(200).json(e)}))})),o.post("*/Santhwanam/diagnosis/update/:id",(function(t,n,e){try{s.findById(t.params.id,(function(e,a){a?(a.name=t.body.name,a.save().then(t=>{n.status(200).json("Update complete")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/diagnosis/delete/:id",(function(t,n){s.findOneAndDelete({_id:t.params.id},(function(t,e){t?n.json(t):n.json("Successfully removed")}))})),t.exports=o},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({name:{type:String}},{collection:"diagnosis"});t.exports=a.model("diagnosis",o)},function(t,n,e){const a=e(0);e(3);const o=a.Router();let s=e(36);o.post("*/Santhwanam/incomeType/add",(function(t,n,e){try{new s(t.body).save().then(n.status(200).send("Success"))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/incomeType",(function(t,n,e){s.find((function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),o.get("*/Santhwanam/incomeType/getIncomeTypes",(function(t,n,e){try{s.find({},{_id:0,incomeType:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/incomeType/edit/:id",(function(t,n){let e=t.params.id;s.findById(e,(function(t,e){n.status(200).json(e)}))})),o.post("*/Santhwanam/incomeType/update/:id",(function(t,n,e){try{s.findById(t.params.id,(function(e,a){a?(a.incomeType=t.body.incomeType,a.save().then(t=>{n.status(200).json("Update complete")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/incomeType/delete/:id",(function(t,n){s.findOneAndDelete({_id:t.params.id},(function(t,e){t?n.json(t):n.json("Successfully removed")}))})),t.exports=o},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({incomeType:{type:String}},{collection:"incomeType"});t.exports=a.model("incomeType",o)},function(t,n,e){const a=e(0);e(3);const o=a.Router();let s=e(38);o.post("*/Santhwanam/expType/add",(function(t,n,e){try{new s(t.body).save().then(n.status(200).send("Success"))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/expType",(function(t,n,e){s.find((function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),o.get("*/Santhwanam/expType/getExpenseTypes",(function(t,n,e){try{s.find({},{_id:0,expType:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/expType/edit/:id",(function(t,n){let e=t.params.id;s.findById(e,(function(t,e){n.status(200).json(e)}))})),o.post("*/Santhwanam/expType/update/:id",(function(t,n,e){try{s.findById(t.params.id,(function(e,a){a?(a.expType=t.body.expType,a.save().then(t=>{n.status(200).json("Update complete")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/expType/delete/:id",(function(t,n){s.findOneAndDelete({_id:t.params.id},(function(t,e){t?n.json(t):n.json("Successfully removed")}))})),t.exports=o},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({expType:{type:String}},{collection:"expType"});t.exports=a.model("expType",o)},function(t,n,e){const a=e(2),o=e(0).Router();let s=e(9),r=e(4),i=e(7);o.post("*/Santhwanam/account/add",(function(t,n,e){try{let e=new s(t.body);e.txndate=a(e.txndate).format("YYYY-MM-DD"),e.chdate=null!==e.chdate?a(e.chdate).format("YYYY-MM-DD"):null,"Cheque"===e.bankMode&&(e.chAmount=e.amount,e.amount=0),e.isReceipt?r.findOne((function(t,n){e.receiptNo=n.receiptNo,n.receiptNo++,n.save(),e.save()})):e.save(),n.status(200).send(e._id)}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/account/addCE",(function(t,n,e){try{let e=new s(t.body);e.txndate=a(e.txndate).format("YYYY-MM-DD"),e.type="Contra Entry",e.name="",e.isReceipt=!1,"Cash"===t.body.source?(e.txntype="Expense",e.desc="Contra Entry - Cash",e.amount=-1*t.body.amount,e.paymentMode="Cash",e.bankMode="",e.bankName=""):(e.desc="Contra Entry - Bank",e.txntype="Expense",e.amount=-1*t.body.amount,e.paymentMode="Bank",e.bankMode="Transfer",e.bankName=t.body.bankName),e.save().then(o=>{e=new s(t.body),e.txndate=a(e.txndate).format("YYYY-MM-DD"),e.desc="Contra Entry",e.type="Contra Entry",e.name="",e.isReceipt=!1,"Cash"===t.body.source?(e.desc="Contra Entry - Bank",e.txntype="Income",e.amount=t.body.amount,e.paymentMode="Bank",e.bankMode="Transfer",e.bankName=t.body.bankName):(e.desc="Contra Entry - Cash",e.txntype="Income",e.amount=t.body.amount,e.paymentMode="Cash",e.bankMode="",e.bankName=""),e.save().then(t=>{n.status(200).send("Success")})})}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/account",(function(t,n,e){var o=new Date(a(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),r=new Date(a(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));s.find({$or:[{txntype:"Income"},{txntype:"Expense"}],txndate:{$gte:o,$lte:r},amount:{$ne:0}},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),o.get("*/Santhwanam/account/getCheques",(function(t,n,e){s.find({bankMode:"Cheque",amount:0},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),o.post("*/Santhwanam/account/receipts",(function(t,n,e){var o=new Date(a(t.body.fromDate).format("YYYY-MM-DD")),r=new Date(a(t.body.toDate).format("YYYY-MM-DD"));s.find({$or:[{txntype:"Income"},{txntype:"Expense"}],txndate:{$gte:o,$lte:r},isReceipt:!0},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),o.get("*/Santhwanam/account/edit/:id",(function(t,n){let e=t.params.id;s.findById(e,(function(t,e){n.status(200).json(e)}))})),o.post("*/Santhwanam/account/update/:id",(function(t,n,e){try{s.findById(t.params.id,(function(e,o){o?(o.desc=t.body.desc,o.type=t.body.type,o.amount=t.body.amount,o.name=t.body.name,o.isReceipt=t.body.isReceipt,o.paymentMode=t.body.paymentMode,o.bankMode=t.body.bankMode,o.bankName=t.body.bankName,o.txnNo=t.body.txnNo,o.chNo=t.body.chNo,o.chBank=t.body.chBank,o.chdate=null!==t.body.chdate&&""!==t.body.chdate?a(t.body.chdate).format("YYYY-MM-DD"):null,o.save().then(t=>{n.status(200).json("Update complete")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/account/delete/:id",(function(t,n){s.findOneAndDelete({_id:t.params.id},(function(t,e){t?n.json(t):n.json("Successfully removed")}))})),o.post("*/Santhwanam/account/summaryReport",(function(t,n,e){var o=new Date(a(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),r=new Date(a(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));try{"Date"===t.body.type?s.aggregate([{$match:{txndate:{$gte:o,$lte:r}}},{$group:{_id:{txntype:"$txntype",txndate:"$txndate"},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.txndate":1}}],(function(t,a){t?e(new Error(t)):n.json(a)})):"Month"===t.body.type?s.aggregate([{$match:{txndate:{$gte:o,$lte:r}}},{$group:{_id:{txntype:"$txntype",month:{$month:"$txndate"},year:{$year:"$txndate"}},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.month":1}}],(function(t,a){t?e(new Error(t)):n.json(a)})):"Year"===t.body.type&&s.aggregate([{$match:{txndate:{$gte:o,$lte:r}}},{$group:{_id:{txntype:"$txntype",year:{$year:"$txndate"}},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.year":1}}],(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/account/detailsReport",(function(t,n,e){var o={data:"",totalAmount:0},r=new Date(a(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),i=new Date(a(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));try{s.aggregate([{$match:{txndate:{$gte:r,$lte:i},txntype:{$eq:t.body.txnType},amount:{$ne:0}}},{$group:{_id:{type:"$type",txntype:"$txntype"},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.type":1}}],(function(t,a){if(t)e(new Error(t));else{o.data=a;var s=0;a.forEach((function(t){s+=t.totalAmount})),o.totalAmount=s,n.status(200).json(o)}}))}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/account/receiptDetails",(function(t,n,e){try{1===t.body.count?s.findById(t.body.ids,(function(t,e){e?n.status(200).json(e):n.status(404).send("Data not found")})):s.find({_id:{$in:t.body.ids.split(",")},isReceipt:!0},(function(t,e){e?n.status(200).json(e):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/account/daybookLedger",(function(t,n,e){try{var o=new Date(a(t.body.fromDate).format("YYYY-MM-DD")),r={totalIncome:0,totalExp:0,ledger:[]},i=0,c=0;s.find({txndate:o,amount:{$ne:0}},null,{sort:{type:1}},(function(t,a){t?e(new Error(t)):(a.forEach((function(t){let n={type:t.type,txntype:t.txntype,amount:t.amount,bankName:t.bankName,_id:t._id};"Income"===t.txntype?i+=t.amount:c+=-1*t.amount,r.ledger.push(n)})),r.totalIncome=i,r.totalExp=c,n.status(200).json(r))}))}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/account/daybookBalance",(function(t,n,e){try{var o,r,c=new Date(a(t.body.fromDate).format("YYYY-MM-DD"));s.aggregate([{$match:{txndate:{$lt:c}}},{$group:{_id:{bankName:"$bankName"},totalAmount:{$sum:"$amount"}}}],(function(t,a){t?e(new Error(t)):(o=a,s.aggregate([{$match:{txndate:{$lte:c}}},{$group:{_id:{bankName:"$bankName"},totalAmount:{$sum:"$amount"}}}],(function(t,a){if(t)e(new Error(t));else{r=a;var s=[];i.find((function(t,e){e.forEach((function(t){let n,e,a=0,i=0;"Cash In Hand"===t.name?(n=o.filter(t=>""===t._id.bankName)[0],e=r.filter(t=>""===t._id.bankName)[0]):(n=o.filter(n=>n._id.bankName===t.name)[0],e=r.filter(n=>n._id.bankName===t.name)[0]),null!=n&&(a=n.totalAmount),null!=e&&(i=e.totalAmount);let c={bankName:t.name,openingBal:a,closingBal:i};s.push(c)})),n.status(200).json(s)}))}})))}))}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/account/monthlyBalance",(function(t,n,e){var o={cash:[],openSum:0,closeSum:0};try{var r,c,d=new Date(a(t.body.fromDate).format("YYYY-MM-DD")),u=new Date(a(t.body.toDate).format("YYYY-MM-DD")),p=0,m=0;s.aggregate([{$match:{txndate:{$lt:d}}},{$group:{_id:{bankName:"$bankName"},totalAmount:{$sum:"$amount"}}}],(function(t,a){t?e(new Error(t)):(r=a,s.aggregate([{$match:{txndate:{$lte:u}}},{$group:{_id:{bankName:"$bankName"},totalAmount:{$sum:"$amount"}}}],(function(t,a){if(t)e(new Error(t));else{c=a;var s=[];i.find((function(t,e){e.forEach((function(t){let n,e,a=0,o=0;"Cash In Hand"===t.name?(n=r.filter(t=>""===t._id.bankName)[0],e=c.filter(t=>""===t._id.bankName)[0]):(n=r.filter(n=>n._id.bankName===t.name)[0],e=c.filter(n=>n._id.bankName===t.name)[0]),null!=n&&(a=n.totalAmount),null!=e&&(o=e.totalAmount),p+=a,m+=o;let i={bankName:t.name,openingBal:a,closingBal:o};s.push(i)})),o.cash=s,o.openSum=p,o.closeSum=m,n.status(200).json(o)}))}})))}))}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/account/processCheque",(function(t,n,e){try{s.findById(t.body._id,(function(t,e){e?(e.amount=e.chAmount,e.txndate=a(new Date).format("YYYY-MM-DD"),e.save().then(t=>{n.status(200).json("Update complete")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/account/chequeReport",(function(t,n,e){try{var a;switch(t.body.status){case"All":a={bankMode:"Cheque"};break;case"Pending":a={bankMode:"Cheque",amount:0};break;case"Cleared":a={bankMode:"Cheque",amount:{$ne:0}}}s.find(a,(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),t.exports=o},function(t,n,e){const a=e(0).Router();let o=e(10),s=e(41);const r=e(2);let i=e(4);function c(t){let n=new s;n.txnDate=r(new Date).format("YYYY-MM-DD"),n.mno=t.mno,n.medName=t.medName,n.txnType=t.txnType,n.desc=t.desc,n.openingMain=t.openingMain,n.openingSub=t.openingSub,n.openingAKit=t.openingAKit,n.openingBKit=t.openingBKit,n.qty=t.qty,n.closingMain=t.closingMain,n.closingSub=t.closingSub,n.closingAKit=t.closingAKit,n.closingBKit=t.closingBKit,n.pno=t.pno,n.patientName=t.patientName,n.save()}function d(t,n){var e=0,a=0,s=0,r=0;o.findOne({mno:t.body.mno},(function(o,i){if(i){let n=parseInt(t.body.qty);e=i.stock.main,a=i.stock.sub,s=i.stock.a_kit,r=i.stock.b_kit,i.stock.sub=parseInt(i.stock.sub)-n,"A Kit"===t.body.transferto?i.stock.a_kit=(isNaN(parseInt(i.stock.a_kit))?0:parseInt(i.stock.a_kit))+parseInt(t.body.qty):"B Kit"===t.body.transferto&&(i.stock.b_kit=(isNaN(parseInt(i.stock.b_kit))?0:parseInt(i.stock.b_kit))+parseInt(t.body.qty)),i.purchase.filter(t=>t.subStock>0&&null!=t.expdate).sort((t,n)=>t.expdate-n.expdate).forEach((function(t){n>0&&(t.subStock<=n?(n-=t.subStock,t.subStock=0):(t.subStock-=n,n=0),t.save({suppressWarning:!0}))})),i.save();var d="",u="";if("OP"===t.body.transferto){let n=t.body.patient.split("] ");d=n[0].replace("[",""),u=n[1]}c({mno:i.mno,medName:i.name,txnType:"Transfer",desc:"Sub to "+t.body.transferto,openingMain:e,openingSub:a,openingAKit:s,openingBKit:r,qty:t.body.qty,closingMain:i.stock.main,closingSub:i.stock.sub,closingAKit:i.stock.a_kit,closingBKit:i.stock.b_kit,pno:d,patientName:u})}else n.status(404).send("Data not found")}))}a.post("*/Santhwanam/medicine/add",(function(t,n,e){try{let e=new o(t.body);o.findOne({name_lower:e.name.toLowerCase()},(function(t,a){a?n.status(200).json("Duplicate Medicine !!"):new Promise((function(t,n){o.countDocuments((function(n,e){var a=++e;t("M"+a)}))})).then((function(t){e.mno=t,e.name_lower=e.name.toLowerCase(),e.purchase[0].invdate=null!==e.purchase[0].invdate?r(e.purchase[0].invdate).format("YYYY-MM-DD"):null,e.purchase[0].expdate=null!==e.purchase[0].expdate?r(e.purchase[0].expdate).format("YYYY-MM-DD"):null,e.purchase[0].mfgdate=null!==e.purchase[0].mfgdate?r(e.purchase[0].mfgdate).format("YYYY-MM-DD"):null,e.save(),n.status(200).json("Medicine Added !!"),c({mno:e.mno,medName:e.name,txnType:"Add",desc:"To main stock",openingMain:0,openingSub:0,openingAKit:0,openingBKit:0,qty:e.stock.main,closingMain:e.stock.main,closingSub:0,closingAKit:0,closingBKit:0,pno:"",patientName:""})}))}))}catch(t){e(new Error(t))}})),a.get("*/Santhwanam/medicine",(function(t,n,e){o.find({},null,{sort:{name:1}},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),a.get("*/Santhwanam/medicine/edit/:id",(function(t,n){let e=t.params.id;o.findById(e,(function(t,e){n.status(200).json(e)}))})),a.post("*/Santhwanam/medicine/update/:id",(function(t,n,e){try{o.findById(t.params.id,(function(e,a){a?(a.name=t.body.name,a.name_lower=a.name.toLowerCase(),a.save().then(t=>{n.status(200).json("Update completed")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),a.get("*/Santhwanam/medicine/delete/:id",(function(t,n){o.findOneAndDelete({_id:t.params.id},(function(t,e){t?n.json(t):n.json("Successfully removed")}))})),a.get("*/Santhwanam/medicine/getNames",(function(t,n,e){o.find({},{_id:0,mno:1,name:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),a.get("*/Santhwanam/medicine/getStock/:mno",(function(t,n,e){o.findOne({mno:t.params.mno},{_id:0,stock:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),a.get("*/Santhwanam/medicine/getDetails/:mno",(function(t,n,e){o.findOne({mno:t.params.mno},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),a.get("*/Santhwanam/medicine/getPurchaseDetails/:mno",(function(t,n,e){o.findOne({mno:t.params.mno},{},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),a.post("*/Santhwanam/medicine/getHistory",(function(t,n,e){console.log(t.body);let a=r(t.body.fromDate).format("YYYY-MM-DD"),o=r(t.body.toDate).format("YYYY-MM-DD");console.log(a),console.log(o),s.find({mno:t.body.mno,txnDate:{$gte:a,$lte:o}},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),a.post("*/Santhwanam/medicine/transfer",(function(t,n,e){try{"Sub Stock"===t.body.stocktype?d(t,n):function(t,n){var e=0,a=0,s=0,r=0;o.findOne({mno:t.body.mno},(function(o,i){if(i){let n=parseInt(t.body.qty);e=i.stock.main,a=i.stock.sub,s=i.stock.a_kit,r=i.stock.b_kit,i.stock.main=parseInt(i.stock.main)-n,i.stock.sub=parseInt(i.stock.sub)+n,i.purchase.filter(t=>t.mainStock>0&&null!=t.expdate).sort((t,n)=>t.expdate-n.expdate).forEach((function(t){n>0&&(t.mainStock<=n?(t.subStock+=t.mainStock,n-=t.mainStock,t.mainStock=0):(t.subStock+=n,t.mainStock-=n,n=0),t.save({suppressWarning:!0}))})),i.save(),c({mno:i.mno,medName:i.name,txnType:"Transfer",desc:"Main to Sub",openingMain:e,openingSub:a,openingAKit:s,openingBKit:r,qty:t.body.qty,closingMain:i.stock.main,closingSub:i.stock.sub,closingAKit:i.stock.a_kit,closingBKit:i.stock.b_kit,pno:"",patientName:""})}else n.status(404).send("Data not found")}))}(t,n),n.status(200).json("Medicine Transferred")}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/medicine/transferOP",(function(t,n,e){try{d(t),n.status(200).json("Medicine Transferred")}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/medicine/transferKit",(function(t,n,e){try{!function(t,n){var e=0,a=0,s=0,r=0;o.findOne({mno:t.body.mno},(function(o,i){if(i){e=i.stock.main,a=i.stock.sub,s=i.stock.a_kit,r=i.stock.b_kit,"A Kit"===t.body.stocktype?i.stock.a_kit=parseInt(i.stock.a_kit)-parseInt(t.body.qty):i.stock.b_kit=parseInt(i.stock.b_kit)-parseInt(t.body.qty),i.save();let n=t.body.patient.split("] "),o=n[0].replace("[",""),d=n[1];c({mno:i.mno,medName:i.name,txnType:"Transfer",desc:t.body.stocktype+" to OP",openingMain:e,openingSub:a,openingAKit:s,openingBKit:r,qty:t.body.qty,closingMain:i.stock.main,closingSub:i.stock.sub,closingAKit:i.stock.a_kit,closingBKit:i.stock.b_kit,pno:o,patientName:d})}else n.status(404).send("Data not found")}))}(t),n.status(200).json("Medicine Transferred")}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/medicine/inbound",(function(t,n,e){try{var a=0,s=0,i=0,d=0;o.findOne({mno:t.body.mno},(function(e,o){if(o){a=o.stock.main,s=o.stock.sub,i=o.stock.a_kit,d=o.stock.b_kit,o.stock.main=parseInt(o.stock.main)+parseInt(t.body.qty);let n=null!=t.body.purchase.invdate&&""!=t.body.purchase.invdate?r(t.body.purchase.invdate).format("YYYY-MM-DD"):null,e=null!=t.body.purchase.expdate&&""!=t.body.purchase.expdate?r(t.body.purchase.expdate).format("YYYY-MM-DD"):null;mfgdate=null!=t.body.purchase.mfgdate&&""!=t.body.purchase.mfgdate?r(t.body.purchase.mfgdate).format("YYYY-MM-DD"):null;const u={expdate:e,mfgdate:mfgdate,rate:t.body.purchase.rate,dealer:t.body.purchase.dealer,invdate:n,invno:t.body.purchase.invno,batchno:t.body.purchase.batchno,mainStock:t.body.purchase.qty,subStock:0};o.purchase.push(u),o.save(),c({mno:o.mno,medName:o.name,txnType:"Inbound",desc:"To main stock",openingMain:a,openingSub:s,openingAKit:i,openingBKit:d,qty:t.body.qty,closingMain:o.stock.main,closingSub:o.stock.sub,closingAKit:o.stock.a_kit,closingBKit:o.stock.b_kit,pno:"",patientName:""})}else n.status(404).send("Data not found")})),n.status(200).json("Medicine Added")}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/medicine/return",(function(t,n,e){try{var a=0,s=0,i=0,d=0;o.findOne({mno:t.body.mno},(function(e,o){if(o){a=o.stock.main,s=o.stock.sub,i=o.stock.a_kit,d=o.stock.b_kit,o.stock.main=parseInt(o.stock.main)-parseInt(t.body.mainRet),o.stock.sub=parseInt(o.stock.sub)-parseInt(t.body.subRet),o.purchase.filter(n=>n._id==t.body.purId).forEach((function(n){n.mainStock-=t.body.mainRet,n.subStock-=t.body.subRet,n.save({suppressWarning:!0})}));const n={expdate:null,mfgdate:null,rate:0,dealer:"",invdate:new Date(r(new Date).format("YYYY-MM-DD")),invno:"",batchno:"",mainStock:parseInt(t.body.mainRet)+parseInt(t.body.subRet),subStock:0,return:1};o.purchase.push(n),o.save(),c({mno:o.mno,medName:o.name,txnType:"Return",desc:"Return stock",openingMain:a,openingSub:s,openingAKit:i,openingBKit:d,qty:parseInt(t.body.mainRet)+parseInt(t.body.subRet),closingMain:o.stock.main,closingSub:o.stock.sub,closingAKit:o.stock.a_kit,closingBKit:o.stock.b_kit,pno:"",patientName:""})}else n.status(404).send("Data not found")})),n.status(200).json("Medicine Returned")}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/medicine/updateStock",(function(t,n,e){try{console.log(t.body);var a=0,s=0,r=0,i=0;o.findOne({mno:t.body.mno},(function(e,o){if(o){a=o.stock.main,s=o.stock.sub,r=o.stock.a_kit,i=o.stock.b_kit,o.stock.main=parseInt(o.stock.main)-parseInt(t.body.mainDiff),o.stock.sub=parseInt(o.stock.sub)-parseInt(t.body.subDiff),o.purchase.filter(n=>n._id==t.body.purId).forEach((function(n){n.mainStock=t.body.mainNew,n.subStock=t.body.subNew,n.save({suppressWarning:!0})})),o.save(),c({mno:o.mno,medName:o.name,txnType:"Edit",desc:"Edit stock",openingMain:a,openingSub:s,openingAKit:r,openingBKit:i,qty:0,closingMain:o.stock.main,closingSub:o.stock.sub,closingAKit:o.stock.a_kit,closingBKit:o.stock.b_kit,pno:"",patientName:""}),n.status(200).json("Medicine Update")}else n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),a.get("*/Santhwanam/medicine/reportExpiry",(function(t,n,e){i.findOne((function(t,a){var s=new Date(r(new Date).format("YYYY-MM-DD")),i=new Date(r((new Date).setTime((new Date).getTime()+864e5*a.medExpiryDays)).format("YYYY-MM-DD"));o.aggregate([{$unwind:"$purchase"},{$unwind:"$purchase.expdate"},{$match:{"purchase.expdate":{$gte:s,$lte:i},$or:[{"purchase.mainStock":{$gt:0}},{"purchase.subStock":{$gt:0}}]}},{$group:{_id:{_id:"$_id",name:"$name",mno:"$mno",expDate:"$purchase.expdate",mainStock:"$purchase.mainStock",subStock:"$purchase.subStock"}}},{$sort:{"_id.expDate":1}}],(function(t,a){t?e(new Error(t)):n.json(a)}))}))})),a.get("*/Santhwanam/medicine/reportExpiryCount",(function(t,n,e){i.findOne((function(t,a){var s=new Date(r(new Date).format("YYYY-MM-DD")),i=new Date(r((new Date).setTime((new Date).getTime()+864e5*a.medExpiryDays)).format("YYYY-MM-DD"));o.aggregate([{$unwind:"$purchase"},{$unwind:"$purchase.expdate"},{$match:{"purchase.expdate":{$gte:s,$lte:i},$or:[{"purchase.mainStock":{$gt:0}},{"purchase.subStock":{$gt:0}}]}},{$group:{_id:null,count:{$sum:1}}}],(function(t,a){t?e(new Error(t)):n.json(a)}))}))})),a.get("*/Santhwanam/medicine/reportThreshold",(function(t,n,e){i.findOne((function(t,a){o.aggregate([{$match:{"stock.main":{$gt:0,$lte:a.medThresholdCount}}},{$group:{_id:{name:"$name",mno:"$mno",mainStock:"$stock.main"}}},{$sort:{"_id.name":1}}],(function(t,a){t?e(new Error(t)):n.json(a)}))}))})),a.get("*/Santhwanam/medicine/reportThresholdCount",(function(t,n,e){i.findOne((function(t,a){o.aggregate([{$unwind:"$purchase"},{$unwind:"$purchase.mainStock"},{$unwind:"$purchase.subStock"},{$match:{"purchase.mainStock":{$gt:0,$lte:a.medThresholdCount}}},{$group:{_id:null,count:{$sum:1}}}],(function(t,a){t?e(new Error(t)):n.json(a)}))}))})),t.exports=a},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({txnDate:{type:Date},mno:{type:String},medName:{type:String},txnType:{type:String},desc:{type:String},openingMain:{type:Number},openingSub:{type:Number},openingAKit:{type:Number},openingBKit:{type:Number},qty:{type:Number},closingMain:{type:Number},closingSub:{type:Number},closingAKit:{type:Number},closingBKit:{type:Number},pno:{type:String},patientName:{type:String}},{collection:"medicineHistory"});t.exports=a.model("medicineHistory",o)},function(t,n,e){const a=e(0).Router();let o=e(10),s=e(8);a.route("*/Santhwanam/dashboard").get((function(t,n,e){try{let t;o.aggregate([{$group:{_id:null,main:{$sum:"$stock.main"},sub:{$sum:"$stock.sub"},a_kit:{$sum:"$stock.a_kit"},b_kit:{$sum:"$stock.b_kit"}}}],(function(a,o){a?e(new Error(a)):(t={stock:o},s.aggregate([{$group:{_id:"$grade",total:{$sum:1}}}],(function(a,o){a?e(new Error(a)):(t.grade=o,n.status(200).json(t))})))}))}catch(t){e(new Error(t))}})),t.exports=a},function(t,n,e){const a=e(0);var o=e(3);const s=a.Router();let r=e(7);s.post("*/Santhwanam/bank/add",(function(t,n,e){try{let e=new r(t.body);new o((function(t,n){r.countDocuments((function(n,e){var a=++e;t("B"+a)}))})).then((function(t){e.bno=t,e.save()})),n.status(200).send("Success")}catch(t){e(new Error(t))}})),s.get("*/Santhwanam/bank",(function(t,n,e){r.find((function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),s.get("*/Santhwanam/bank/getBanks",(function(t,n,e){try{r.find((function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),s.get("*/Santhwanam/bank/edit/:id",(function(t,n){let e=t.params.id;r.findById(e,(function(t,e){n.status(200).json(e)}))})),s.post("*/Santhwanam/bank/update/:id",(function(t,n,e){try{r.findById(t.params.id,(function(e,a){a?(a.name=t.body.name,a.save().then(t=>{n.status(200).json("Update complete")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),s.get("*/Santhwanam/bank/getBankName/:bank",(function(t,n,e){try{r.findOne({bno:t.params.bank},(function(t,e){e?n.status(200).json(e.name):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),s.get("*/Santhwanam/bank/delete/:id",(function(t,n){r.findOneAndDelete({_id:t.params.id},(function(t,e){t?n.json(t):n.json("Successfully removed")}))})),t.exports=s},function(t,n,e){const a=e(0);e(3);const o=a.Router();let s=e(11);const r=e(2);o.post("*/Santhwanam/cashBalance/save",(function(t,n,e){try{let e=new s(t.body);e.month=r(e.month).format("YYYY-MM-DD"),s.findOne({month:e.month},(function(t,a){a?(Object.values(e.balance).forEach((function(t){if(null!=t.bno){var n=!1;Object.values(a.balance).forEach((function(e){null!=e.bno&&e.bno==t.bno&&(e.open=t.open,e.close=t.close,n=!0)})),n||a.balance.push({bno:t.bno,bankName:t.bankName,open:t.open,close:t.close})}})),a.save().then(n.status(200).send("Success"))):e.save().then(n.status(200).send("Success"))}))}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/cashBalance/load",(function(t,n,e){try{var a=new Date(r(t.body.month).format("YYYY-MM-DD"));s.findOne({month:a},(function(t,e){n.status(200).json(e)}))}catch(t){e(new Error(t))}})),o.get("*/Santhwanam/cashBalance",(function(t,n,e){IncomeType.find((function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),t.exports=o},function(t,n,e){const a=e(0).Router();let o=e(11);const s=e(2);a.post("*/Santhwanam/report/monthly",(function(t,n,e){try{var a={cash:[],openSum:0,closeSum:0},r=new Date(s(t.body.fromDate).format("YYYY-MM-DD")),i=new Date(s(new Date(s(t.body.toDate).get("year"),s(t.body.toDate).get("month"),1)).format("YYYY-MM-DD"));o.find({$or:[{month:r},{month:i}]},null,{sort:{month:1}},(function(t,e){var o=0,s=0;e?1===e.length?(e[0].balance.forEach((function(t){o+=t.open,s+=t.close})),a.openSum=o,a.closeSum=s,a.cash=e[0].balance):(e[0].balance.forEach((function(t){o+=t.open})),a.openSum=o,e[1].balance.forEach((function(t){s+=t.close})),a.closeSum=s,e[0].balance.forEach((function(t){var n=0,o=e[1].balance.filter(n=>n.bno===t.bno)[0];null!=o&&(n=o.close);var s={_id:t._id,bankName:t.bankName,open:t.open,close:n};a.cash.push(s)}))):n.status(200).json("NA"),n.status(200).json(a)}))}catch(t){e(new Error(t))}})),t.exports=a},function(t,n,e){const a=e(0).Router();let o=e(47),s=e(48);const r=e(2);a.post("*/Santhwanam/equipment/add",(function(t,n,e){try{let e=new o(t.body);o.findOne({name_lower:e.name.toLowerCase()},(function(n,a){a?(a.stock.inuse=parseInt(t.body.stock.inuse),a.stock.damage=parseInt(t.body.stock.damage),a.stock.stock=parseInt(t.body.stock.stock),a.save()):new Promise((function(t,n){o.countDocuments((function(n,e){var a=++e;t("E"+a)}))})).then((function(t){e.eno=t,e.name_lower=e.name.toLowerCase(),e.save()}))})),n.status(200).json("Equipment added")}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/equipment/dispose",(function(t,n,e){try{o.findById(t.body.eid,(function(e,a){if(a){let e=new s(t.body);e.txnDate=r(new Date).format("YYYY-MM-DD"),e.save().then(o=>{a.stock.damage-=t.body.qty,a.save().then(t=>{n.status(200).json(e._id)})})}else n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),a.get("*/Santhwanam/equipment",(function(t,n,e){o.find({},null,{sort:{name:1}},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),a.get("*/Santhwanam/equipment/edit/:id",(function(t,n){let e=t.params.id;o.findById(e,(function(t,e){n.status(200).json(e)}))})),a.post("*/Santhwanam/equipment/update/:id",(function(t,n,e){try{o.findById(t.params.id,(function(e,a){a?(a.name=t.body.name,a.name_lower=a.name.toLowerCase(),a.stock.inuse=t.body.stock.inuse,a.stock.stock=t.body.stock.stock,a.stock.damage=t.body.stock.damage,a.save()):n.status(404).send("Data not found")})),n.status(200).json("Update completed")}catch(t){e(new Error(t))}})),a.get("*/Santhwanam/equipment/getNames",(function(t,n,e){o.find({},{_id:0,eno:1,name:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),a.get("*/Santhwanam/equipment/getStock/:eno",(function(t,n,e){o.findOne({eno:t.params.eno},{_id:0,stock:1},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),a.get("*/Santhwanam/equipment/tracker/:eno",(function(t,n,e){o.findOne({eno:t.params.eno},{},(function(t,a){if(t)e(new Error(t));else{var o=a.tracker.filter(t=>null===t.indate);n.status(200).json(o)}}))})),a.post("*/Santhwanam/equipment/transfer",(function(t,n,e){try{o.findOne({eno:t.body.eno},(function(e,a){if(a){a.stock.stock=parseInt(a.stock.stock)-parseInt(t.body.qty),a.stock.inuse=parseInt(a.stock.inuse)+parseInt(t.body.qty);const n={patientname:t.body.patientname,qty:t.body.qty,outdate:t.body.outdate,indate:null};n.outdate=r(n.outdate).format("YYYY-MM-DD"),a.tracker.push(n),a.save()}else n.status(404).send("Data not found")})),n.status(200).json("Equipment Transferred")}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/equipment/return",(function(t,n,e){try{o.findOne({eno:t.body.eno},(function(n,e){e.stock.stock=parseInt(e.stock.stock)+parseInt(t.body.qty),e.stock.inuse=parseInt(e.stock.inuse)-parseInt(t.body.qty),e.tracker.forEach((function(n){n._id==t.body._id&&(n.indate=t.body.indate,n.indate=r(n.indate).format("YYYY-MM-DD"),e.save())}))})),n.status(200).json("Equipment Returned")}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/equipment/report",(function(t,n,e){var a=[];""===t.body.eno?o.find({},null,{sort:{name:1}},(function(t,a){t?e(new Error(t)):n.status(200).json(a)})):o.findOne({eno:t.body.eno},(function(t,o){t?e(new Error(t)):(a.push(o),n.status(200).json(a))}))})),a.post("*/Santhwanam/equipment/disposeDetails",(function(t,n,e){console.log(t.body);try{1===t.body.count?s.findById(t.body.ids,(function(t,e){e?n.status(200).json(e):n.status(404).send("Data not found")})):s.find({_id:{$in:t.body.ids.split(",")}},(function(t,e){e?n.status(200).json(e):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/equipment/disposeList",(function(t,n,e){var a=new Date(r(t.body.fromDate).format("YYYY-MM-DD")),o=new Date(r(t.body.toDate).format("YYYY-MM-DD"));s.find({txnDate:{$gte:a,$lte:o}},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),t.exports=a},function(t,n,e){const a=e(1),o=a.Schema;let s=new o({stock:{type:Number},damage:{type:Number},inuse:{type:Number}}),r=new o({patientname:{type:String},qty:{type:Number},outdate:{type:Date},indate:{type:Date}}),i=new o({eno:{type:String},name:{type:String},name_lower:{type:String},stock:s,tracker:[r]},{collection:"equipment"});t.exports=a.model("equipment",i)},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({eno:{type:String},name:{type:String},desc:{type:String},qty:{type:Number},txnDate:{type:Date}},{collection:"equipmentDispose"});t.exports=a.model("equipmentDispose",o)},function(t,n,e){const a=e(0).Router();let o=e(50),s=e(7);const r=e(2);a.post("*/Santhwanam/bankLedger/add",(function(t,n,e){try{let e=new o(t.body);null!=e.txnDate&&""!=e.txnDate&&(e.txnDate=r(e.txnDate).format("YYYY-MM-DD")),e.save().then(n.status(200).send("Success"))}catch(t){e(new Error(t))}})),a.get("*/Santhwanam/bankLedger/:bno",(function(t,n,e){o.find({bno:t.params.bno},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),a.get("*/Santhwanam/bankLedger/getBalance/:bno",(function(t,n,e){o.aggregate([{$match:{bno:{$eq:t.params.bno}}},{$group:{_id:null,balance:{$sum:"$amount"}}}],(function(t,a){t?e(new Error(t)):n.json(a)}))})),a.post("*/Santhwanam/bankLedger/update/:id",(function(t,n,e){try{o.findById(t.params.id,(function(e,a){a?(a.txnType=t.body.txnType,a.amount=t.body.amount,a.save().then(t=>{n.status(200).json("Update completed")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/bankLedger/daybookBalance",(function(t,n,e){try{var a,i,c=new Date(r(t.body.fromDate).format("YYYY-MM-DD"));o.aggregate([{$match:{txnDate:{$lt:c}}},{$group:{_id:{bno:"$bno"},totalAmount:{$sum:"$amount"}}}],(function(t,r){t?e(new Error(t)):(a=r,o.aggregate([{$match:{txnDate:{$lte:c}}},{$group:{_id:{bno:"$bno"},totalAmount:{$sum:"$amount"}}}],(function(t,o){if(t)e(new Error(t));else{i=o;var r=[];s.find({cash:!1},(function(t,e){e.forEach((function(t){let n=0,e=0,o=a.filter(n=>n._id.bno===t.bno)[0],s=i.filter(n=>n._id.bno===t.bno)[0];null!=o&&(n=o.totalAmount),null!=s&&(e=s.totalAmount);let c={bankName:t.name,openingBal:n,closingBal:e};r.push(c)})),n.status(200).json(r)}))}})))}))}catch(t){e(new Error(t))}})),a.post("*/Santhwanam/bankLedger/daybookLedger",(function(t,n,e){try{var a=new Date(r(t.body.fromDate).format("YYYY-MM-DD")),i={totalDeposit:0,totalWithdraw:0,ledger:[]},c=0,d=0;o.find({txnDate:a},null,{sort:{bno:1}},(function(t,a){t?e(new Error(t)):s.find({cash:!1},(function(t,e){a.forEach((function(t){let n="",a=e.filter(n=>n.bno===t.bno)[0];null!=a&&(n=a.name);let o={bankName:n,txnType:t.txnType,amount:t.amount,_id:t._id};"Deposit"===t.txnType?c+=t.amount:d+=-1*t.amount,i.ledger.push(o)})),i.totalDeposit=c,i.totalWithdraw=d,n.status(200).json(i)}))}))}catch(t){e(new Error(t))}})),t.exports=a},function(t,n,e){const a=e(1);let o=new(0,a.Schema)({bno:{type:String},txnType:{type:String},txnDate:{type:Date},amount:{type:Number}},{collection:"bankLedger"});t.exports=a.model("bankLedger",o)},function(t,n,e){const a=e(2),o=e(0).Router();let s=e(9);o.post("*/Santhwanam/receipt/add",(function(t,n,e){try{let e=new s(t.body);e.txndate=a(e.txndate).tz("Asia/Calcutta").format("YYYY-MM-DD"),e.save().then(n.status(200).send("Success"))}catch(t){e(new Error(t))}})),o.post("*/Santhwanam/receipt",(function(t,n,e){var o=new Date(a(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),r=new Date(a(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));s.find({$or:[{txntype:"Voucher"},{txntype:"Receipt"}],txndate:{$gte:o,$lte:r}},(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))})),o.get("*/Santhwanam/receipt/edit/:id",(function(t,n){let e=t.params.id;s.findById(e,(function(t,e){n.status(200).json(e)}))})),o.post("*/Santhwanam/receipt/update/:id",(function(t,n,e){try{s.findById(t.params.id,(function(e,a){a?(a.desc=t.body.desc,a.name=t.body.name,a.amount=t.body.amount,"Receipt"===a.txntype&&(a.type=t.body.type),a.save().then(t=>{n.status(200).json("Update complete")})):n.status(404).send("Data not found")}))}catch(t){e(new Error(t))}})),o.post("*/account/summaryReport",(function(t,n,e){var o=new Date(a(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),r=new Date(a(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));try{"Date"===t.body.type?s.aggregate([{$match:{txndate:{$gte:o,$lte:r}}},{$group:{_id:{txntype:"$txntype",txndate:"$txndate"},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.txndate":1}}],(function(t,a){t?e(new Error(t)):n.json(a)})):"Month"===t.body.type?s.aggregate([{$match:{txndate:{$gte:o,$lte:r}}},{$group:{_id:{txntype:"$txntype",month:{$month:"$txndate"},year:{$year:"$txndate"}},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.month":1}}],(function(t,a){t?e(new Error(t)):n.json(a)})):"Year"===t.body.type&&s.aggregate([{$match:{txndate:{$gte:o,$lte:r}}},{$group:{_id:{txntype:"$txntype",year:{$year:"$txndate"}},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.year":1}}],(function(t,a){t?e(new Error(t)):n.status(200).json(a)}))}catch(t){e(new Error(t))}})),o.post("*/account/detailsReport",(function(t,n,e){var o={data:"",totalAmount:0},r=new Date(a(t.body.fromDate).tz("Asia/Calcutta").format("YYYY-MM-DD")),i=new Date(a(t.body.toDate).tz("Asia/Calcutta").format("YYYY-MM-DD"));try{s.aggregate([{$match:{txndate:{$gte:r,$lte:i},txntype:{$eq:t.body.txnType}}},{$group:{_id:{type:"$type",txntype:"$txntype"},totalAmount:{$sum:"$amount"}}},{$sort:{"_id.type":1}}],(function(t,a){if(t)e(new Error(t));else{o.data=a;var s=0;a.forEach((function(t){s+=t.totalAmount})),o.totalAmount=s,n.status(200).json(o)}}))}catch(t){e(new Error(t))}})),t.exports=o},function(t,n,e){const a=e(1);e(12).config();const o=e(6).getCrytoHelperInstance();e(53).production;let s="mongodb://pnpadmin:"+o.decryptField("b07d11be61d08671cf5a24bf89be84121a5d08fea1f86c54954b")+"@localhost:27017/PnP";a.Promise=global.Promise,a.connect(s,{useNewUrlParser:!0}).then(()=>{console.log("Database is connected..")},t=>{console.log("Can not connect to the database"+t)})},function(t){t.exports=JSON.parse('{"DEV":{"MONGO_USER":"pnpadmin","MONGO_PASSWORD":"b07d11be61d08671cf5a24bf89be84121a5d08fea1f86c54954b","MONGO_SERVER":"localhost:27017/PnP"},"TEST":{"MONGO_USER":"pnpadmin","MONGO_PASSWORD":"b07d11be61d08671cf5a24bf89be84121a5d08fea1f86c54954b","MONGO_SERVER":"localhost:2701711/PnP"},"PROD":{"MONGO_USER":"pnpadmin","MONGO_PASSWORD":"b07d11be61d08671cf5a24bf89be84121a5d08fea1f86c54954b","MONGO_SERVER":"localhost:27017/PnP"}}')}]);